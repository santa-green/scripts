<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>English IPA + Alphabet Trainer</title>
  <style>
    :root{
      --bg:#0f172a; --card:#0c1226; --muted:#a7b0c2; --text:#e7ebf2;
      --border:#20304a;
      --danger:#ef4444;          /* red */
      --success:#22c55e;         /* green */
      --tab:#1b2a4a;             /* brighter UI */
      --tab-active:#2563eb;
      --chip:#18223a; 
      --chip-active:#1f2d4a;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
      color:var(--text);
      background:radial-gradient(1200px 800px at 10% -10%, #1f2937 0, #0b1022 55%, #050814 100%);
      min-height:100vh; padding:24px;
    }
    header{max-width:1200px;margin:0 auto 18px auto;display:grid;gap:10px}
    h1{margin:0;font-size:28px;letter-spacing:.2px}
    .sub{color:var(--muted)}

    /* Tabs + quiz toggles (one block) */
    .tabs{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .tab{
      padding:10px 16px;border-radius:999px;cursor:pointer;border:1px solid transparent;
      background:linear-gradient(180deg,var(--tab),#1e3160);
      color:#e9f0ff;font-weight:600; box-shadow:0 4px 16px rgba(0,0,0,.2);
      transition:transform .12s ease, box-shadow .12s ease, background .2s ease, border-color .2s ease;
    }
    .tab:hover{transform:translateY(-1px); box-shadow:0 8px 22px rgba(0,0,0,.28)}
    .tab.active{
      background:linear-gradient(180deg,#3b82f6,var(--tab-active));
      border-color:#7fb0ff;
      color:white;
    }

    .toolbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .chip{
      border:1px solid #2a3d63;background:linear-gradient(180deg,var(--chip),#1a2745);
      color:var(--text); padding:9px 14px;border-radius:999px;cursor:pointer;user-select:none;
      font-weight:600; letter-spacing:.2px;
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.04);
      transition:background .2s, transform .12s, box-shadow .2s;
    }
    .chip:hover{transform:translateY(-1px); box-shadow:0 6px 18px rgba(0,0,0,.25)}
    .chip.active{background:linear-gradient(180deg,#334d7d,#2a4070)}

    .grow{flex:1}
    .search{
      width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);
      background:#0b1224;color:var(--text);outline:none
    }

    .grid{max-width:1200px;margin:10px auto 24px auto;display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:14px}
    .card{
      background:linear-gradient(180deg,#0f1631, var(--card)); border:1px solid var(--border);border-radius:14px; padding:14px;
      display:flex;gap:10px;flex-direction:column; min-height:170px;transition:transform .15s ease, box-shadow .15s ease
    }
    .card:hover{transform:translateY(-2px); box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .ipa{font-size:34px; font-weight:800}
    .letter{font-size:34px;font-weight:900}
    .tag{font-size:12px;color:#cbd5ff;background:rgba(99,102,241,.15);border:1px solid rgba(99,102,241,.35);padding:4px 8px;border-radius:999px;display:inline-block}
    .ru{color:#d8deea}
    .examples{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .ex{border:1px dashed var(--border);padding:6px 8px;border-radius:10px;display:flex;gap:8px;align-items:center;background:#0a0f20}

    /* Buttons */
    .btn{
      background:linear-gradient(180deg,#1b2a4a,#15233f); border:1px solid #2c4475; color:#f0f6ff;
      padding:9px 14px;border-radius:12px;cursor:pointer;transition:.15s; user-select:none;font-weight:700;
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.06), 0 6px 16px rgba(37,99,235,.15);
    }
    .btn:hover{border-color:#3a5ba2; background:linear-gradient(180deg,#23375b,#1b2d53)}
    .btn.warn{background:linear-gradient(180deg,#f59e0b,#d97706);border-color:#fbbf24;color:#201400}

    .bar{max-width:1200px;margin:0 auto 16px auto;display:flex;gap:8px;flex-wrap:wrap}
    .muted{color:var(--muted)}

    /* Quiz box */
    .quiz{max-width:1200px;margin:0 auto;border:1px solid var(--border);border-radius:14px;padding:14px;background:linear-gradient(180deg,#0b1224,#0a0f20); display:none}
    .q-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px;flex-wrap:wrap}
    .q-symbol{font-size:42px;font-weight:900;color:#fff} /* white on dark bg */
    .answers{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px}
    .ans{
      padding:12px;border:2px solid #2a3e6a;border-radius:12px;background:#0a1430;cursor:pointer;text-align:left;
      transition:border-color .15s, background .2s, transform .08s;
      color:#e7ebf2; /* make the base text light, not black */
    }
    .ans:hover{transform:translateY(-1px)}
    /* Make the WORD inside answers white (matches transcription visibility) */
    .ans b{color:#fff}
    /* Stronger right/wrong highlights */
    .ans.correct{border-color:var(--success); background:rgba(34,197,94,.12); color:#fff}
    .ans.wrong{border-color:var(--danger); background:rgba(239,68,68,.12); color:#fff}
    .pill{display:inline-flex;gap:8px;align-items:center}

    /* Alphabet */
    .imgbox{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .emoji{font-size:42px;filter:drop-shadow(0 2px 6px rgba(0,0,0,.25))}
    .wru{font-size:13px;color:var(--muted)}
    .section{display:none}
    .section.active{display:block}
    .footer{max-width:1200px;margin:12px auto;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <header>
    <h1>English IPA + Alphabet Trainer <span class="muted" style="font-size:13px">offline ‚Ä¢ beginner-friendly</span></h1>
    <div class="sub">–î–≤–µ —á–∞—Å—Ç–∏: <b>–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è (IPA)</b> –∏ <b>–ê–ª—Ñ–∞–≤–∏—Ç</b>. –ï—Å—Ç—å –æ–∑–≤—É—á–∫–∞ —Å–ª–æ–≤ –∏ –¥–≤–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã.</div>

    <!-- One block: tabs + quiz toggles -->
    <div class="tabs" role="tablist">
      <button id="tabIpa" class="tab active" role="tab" aria-selected="true">–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è</button>
      <button id="tabAbc" class="tab" role="tab" aria-selected="false">–ê–ª—Ñ–∞–≤–∏—Ç</button>
      <button id="toggleQuizIpa" class="tab" role="tab" aria-selected="false">–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –ø–æ IPA</button>
      <button id="toggleQuizAbc" class="tab" role="tab" aria-selected="false">–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</button>
    </div>
  </header>

  <!-- IPA SECTION -->
  <section id="secIpa" class="section active" aria-labelledby="tabIpa">
    <div class="toolbar">
      <div class="pill" role="group" aria-label="filters">
        <div class="chip active" data-filter="all">–í—Å–µ</div>
        <div class="chip" data-filter="vowel">–ì–ª–∞—Å–Ω—ã–µ</div>
        <div class="chip" data-filter="diphthong">–î–∏—Ñ—Ç–æ–Ω–≥–∏</div>
        <div class="chip" data-filter="consonant">–°–æ–≥–ª–∞—Å–Ω—ã–µ</div>
      </div>
      <div class="grow"><input id="search" class="search" type="search" placeholder="–ü–æ–∏—Å–∫: —Å–∏–º–≤–æ–ª, —Å–ª–æ–≤–æ, –ø–µ—Ä–µ–≤–æ–¥‚Ä¶" aria-label="–ü–æ–∏—Å–∫"/></div>
      <button id="ttsTest" class="btn warn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–≤—É–∫ üîä</button>
    </div>

    <section id="cards" class="grid" aria-live="polite"></section>

    <div class="bar">
      <button id="resetFilters" class="btn">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
      <button id="shuffle" class="btn">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å</button>
    </div>

    <section id="quizIpa" class="quiz" aria-live="polite">
      <div class="q-head">
        <div class="pill">
          <div class="q-symbol" id="qSymbol">/iÀê/</div>
          <span class="tag" id="qTag">vowel</span>
        </div>
        <div class="pill">
          <label class="muted" for="modeIpa">—Ä–µ–∂–∏–º:</label>
          <select id="modeIpa" class="btn">
            <option value="word">–ù–∞–π–¥–∏ —Å–ª–æ–≤–æ –ø–æ —Å–∏–º–≤–æ–ª—É</option>
            <option value="symbol">–í—ã–±–µ—Ä–∏ —Å–∏–º–≤–æ–ª –ø–æ —Å–ª–æ–≤—É</option>
          </select>
        </div>
        <div class="pill">
          <span id="qProgress" class="muted">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 10</span>
          <button id="qSkip" class="btn">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
          <button id="qNext" class="btn">–î–∞–ª—å—à–µ</button>
        </div>
      </div>
      <div id="qTip" class="ru" style="margin:0 0 10px 0"></div>
      <div id="answers" class="answers"></div>
    </section>
  </section>

  <!-- ALPHABET SECTION -->
  <section id="secAbc" class="section" aria-labelledby="tabAbc">
    <div class="toolbar">
      <div class="grow"><input id="searchAbc" class="search" type="search" placeholder="–ü–æ–∏—Å–∫: –±—É–∫–≤–∞, —Å–ª–æ–≤–æ‚Ä¶" aria-label="–ü–æ–∏—Å–∫ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É"/></div>
    </div>

    <section id="abcCards" class="grid" aria-live="polite"></section>

    <section id="quizAbc" class="quiz" aria-live="polite">
      <div class="q-head">
        <div class="pill">
          <div class="q-symbol" id="aSymbol">A</div>
          <span class="tag">alphabet</span>
        </div>
        <div class="pill">
          <label class="muted" for="modeAbc">—Ä–µ–∂–∏–º:</label>
          <select id="modeAbc" class="btn">
            <option value="pickWord">–í—ã–±–µ—Ä–∏ —Å–ª–æ–≤–æ –ø–æ –±—É–∫–≤–µ</option>
            <option value="pickLetter">–í—ã–±–µ—Ä–∏ –±—É–∫–≤—É –ø–æ —Å–ª–æ–≤—É</option>
          </select>
        </div>
        <div class="pill">
          <span id="aProgress" class="muted">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 10</span>
          <button id="aSkip" class="btn">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
          <button id="aNext" class="btn">–î–∞–ª—å—à–µ</button>
        </div>
      </div>
      <div id="aTip" class="ru" style="margin:0 0 10px 0">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</div>
      <div id="aAnswers" class="answers"></div>
    </section>
  </section>

  <div class="footer">
    –°–æ–≤–µ—Ç: –≤ –∞–ª—Ñ–∞–≤–∏—Ç–µ –æ–±—Ä–∞—â–∞–π—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ <b>–Ω–∞–∑–≤–∞–Ω–∏—è –±—É–∫–≤</b> (A /e…™/, B /biÀê/, C /siÀê/ ‚Ä¶) ‚Äî –æ–Ω–∏ –ø–æ–º–æ–≥–∞—é—Ç –ø—Ä–∏ –¥–∏–∫—Ç–æ–≤–∫–µ e-mail –∏ –∏–º—ë–Ω. –ê –¥–ª—è —á—Ç–µ–Ω–∏—è —Å–ª–æ–≤ –≤–∞–∂–Ω–µ–µ <b>–∑–≤—É–∫–∏ IPA</b>.
  </div>

<script>
/***************** DATA: IPA *****************/
const IPA = [
  {cat:"vowel", sym:"/iÀê/", ru:"–¥–æ–ª–≥–∏–π ¬´–∏¬ª, –≥—É–±—ã –≤ —É–ª—ã–±–∫–µ", ex:[{w:"see", ipa:"/siÀê/", ru:"–≤–∏–¥–µ—Ç—å"},{w:"green", ipa:"/…°riÀên/", ru:"–∑–µ–ª—ë–Ω—ã–π"}]},
  {cat:"vowel", sym:"/…™/",  ru:"–∫—Ä–∞—Ç–∫–∏–π ¬´–∏¬ª, –±–æ–ª–µ–µ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ", ex:[{w:"sit", ipa:"/s…™t/", ru:"—Å–∏–¥–µ—Ç—å"},{w:"ship", ipa:"/ É…™p/", ru:"–∫–æ—Ä–∞–±–ª—å"}]},
  {cat:"vowel", sym:"/e/",  ru:"–∫–∞–∫ ¬´—ç¬ª –≤ ¬´—ç—Ç–æ¬ª", ex:[{w:"bed", ipa:"/bed/", ru:"–∫—Ä–æ–≤–∞—Ç—å"},{w:"ten", ipa:"/ten/", ru:"–¥–µ—Å—è—Ç—å"}]},
  {cat:"vowel", sym:"/√¶/",  ru:"–º–µ–∂–¥—É ¬´–∞¬ª –∏ ¬´—ç¬ª, —à–∏—Ä–æ–∫–æ", ex:[{w:"cat", ipa:"/k√¶t/", ru:"–∫–æ—Ç"},{w:"black", ipa:"/bl√¶k/", ru:"—á—ë—Ä–Ω—ã–π"}]},
  {cat:"vowel", sym:"/…ëÀê/", ru:"–¥–æ–ª–≥–æ–µ –æ—Ç–∫—Ä—ã—Ç–æ–µ ¬´–∞¬ª", ex:[{w:"car", ipa:"/k…ëÀê/", ru:"–º–∞—à–∏–Ω–∞"},{w:"start", ipa:"/st…ëÀêt/", ru:"–Ω–∞—á–∏–Ω–∞—Ç—å"}]},
  {cat:"vowel", sym:"/…í/",  ru:"–∫—Ä–∞—Ç–∫–æ–µ ¬´o¬ª (BrE)", ex:[{w:"hot", ipa:"/h…ít/", ru:"–≥–æ—Ä—è—á–∏–π"},{w:"not", ipa:"/n…ít/", ru:"–Ω–µ—Ç, –Ω–µ"}]},
  {cat:"vowel", sym:"/…îÀê/", ru:"–¥–æ–ª–≥–æ–µ ¬´–æ¬ª (–≥—É–±—ã –æ–∫—Ä—É–≥–ª–∏—Ç—å)", ex:[{w:"door", ipa:"/d…îÀê/", ru:"–¥–≤–µ—Ä—å"},{w:"talk", ipa:"/t…îÀêk/", ru:"–≥–æ–≤–æ—Ä–∏—Ç—å"}]},
  {cat:"vowel", sym:"/ ä/",  ru:"–∫—Ä–∞—Ç–∫–æ–µ ¬´—É¬ª, —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ", ex:[{w:"book", ipa:"/b äk/", ru:"–∫–Ω–∏–≥–∞"},{w:"good", ipa:"/…° äd/", ru:"—Ö–æ—Ä–æ—à–∏–π"}]},
  {cat:"vowel", sym:"/uÀê/", ru:"–¥–æ–ª–≥–æ–µ ¬´—É¬ª", ex:[{w:"blue", ipa:"/bluÀê/", ru:"—Å–∏–Ω–∏–π"},{w:"food", ipa:"/fuÀêd/", ru:"–µ–¥–∞"}]},
  {cat:"vowel", sym:"/ å/",  ru:"–∫—Ä–∞—Ç–∫–æ–µ ¬´–∞/ å¬ª, —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ", ex:[{w:"cup", ipa:"/k åp/", ru:"—á–∞—à–∫–∞"},{w:"bus", ipa:"/b ås/", ru:"–∞–≤—Ç–æ–±—É—Å"}]},
  {cat:"vowel", sym:"/…úÀê/", ru:"–¥–æ–ª–≥–æ–µ ¬´—ë/√∂¬ª (BrE)", ex:[{w:"bird", ipa:"/b…úÀêd/", ru:"–ø—Ç–∏—Ü–∞"},{w:"learn", ipa:"/l…úÀên/", ru:"—É—á–∏—Ç—å(—Å—è)"}]},
  {cat:"vowel", sym:"/…ô/",  ru:"—à–≤–∞: –±–µ–∑—É–¥–∞—Ä–Ω—ã–π, –æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–π", ex:[{w:"about", ipa:"/…ôÀàba ät/", ru:"–æ, –æ–∫–æ–ª–æ"},{w:"teacher", ipa:"/ÀàtiÀêt É…ô/", ru:"—É—á–∏—Ç–µ–ª—å"}]},
  {cat:"diphthong", sym:"/e…™/", ru:"–∫–∞–∫ ¬´—ç–π¬ª", ex:[{w:"name", ipa:"/ne…™m/", ru:"–∏–º—è"},{w:"day", ipa:"/de…™/", ru:"–¥–µ–Ω—å"}]},
  {cat:"diphthong", sym:"/a…™/", ru:"–∫–∞–∫ ¬´–∞–π¬ª", ex:[{w:"time", ipa:"/ta…™m/", ru:"–≤—Ä–µ–º—è"},{w:"five", ipa:"/fa…™v/", ru:"–ø—è—Ç—å"}]},
  {cat:"diphthong", sym:"/…î…™/", ru:"–∫–∞–∫ ¬´–æ–π¬ª", ex:[{w:"boy", ipa:"/b…î…™/", ru:"–º–∞–ª—å—á–∏–∫"},{w:"coin", ipa:"/k…î…™n/", ru:"–º–æ–Ω–µ—Ç–∞"}]},
  {cat:"diphthong", sym:"/a ä/", ru:"–∫–∞–∫ ¬´–∞—É¬ª", ex:[{w:"house", ipa:"/ha äs/", ru:"–¥–æ–º"},{w:"now", ipa:"/na ä/", ru:"—Å–µ–π—á–∞—Å"}]},
  {cat:"diphthong", sym:"/…ô ä/", ru:"–∫–∞–∫ ¬´–æ—É¬ª (BrE), AmE: /o ä/", ex:[{w:"go", ipa:"/g…ô ä/", ru:"–∏–¥—Ç–∏"},{w:"home", ipa:"/h…ô äm/", ru:"–¥–æ–º"}]},
  {cat:"diphthong", sym:"/…™…ô/", ru:"¬´–∏—ç¬ª (BrE, —Ä–µ–∂–µ)", ex:[{w:"ear", ipa:"/…™…ô/", ru:"—É—Ö–æ"},{w:"idea", ipa:"/a…™Ààd…™…ô/", ru:"–∏–¥–µ—è"}]},
  {cat:"diphthong", sym:"/e…ô/", ru:"¬´—ç–∞¬ª (BrE)", ex:[{w:"hair", ipa:"/he…ô/", ru:"–≤–æ–ª–æ—Å—ã"},{w:"care", ipa:"/ke…ô/", ru:"–∑–∞–±–æ—Ç–∞"}]},
  {cat:"diphthong", sym:"/ ä…ô/", ru:"¬´—É—ç¬ª (BrE, —Ä–µ–¥–∫–∏–π)", ex:[{w:"tour", ipa:"/t ä…ô/", ru:"—Ç—É—Ä"},{w:"sure", ipa:"/ É ä…ô/ (BrE)", ru:"—É–≤–µ—Ä–µ–Ω–Ω—ã–π"}]},
  {cat:"consonant", sym:"/p/",  ru:"–≥–ª—É—Ö–æ–π, –∫–∞–∫ —Ä—É—Å. ¬´–ø¬ª", ex:[{w:"pen", ipa:"/pen/", ru:"—Ä—É—á–∫–∞"},{w:"cap", ipa:"/k√¶p/", ru:"–∫–µ–ø–∫–∞"}]},
  {cat:"consonant", sym:"/b/",  ru:"–∑–≤–æ–Ω–∫–∏–π, –∫–∞–∫ ¬´–±¬ª", ex:[{w:"bag", ipa:"/b√¶…°/", ru:"—Å—É–º–∫–∞"},{w:"cab", ipa:"/k√¶b/", ru:"—Ç–∞–∫—Å–∏"}]},
  {cat:"consonant", sym:"/t/",  ru:"–≥–ª—É—Ö–æ–π ¬´—Ç¬ª, –∫–æ–Ω—á–∏–∫ —É –∑—É–±–æ–≤", ex:[{w:"ten", ipa:"/ten/", ru:"–¥–µ—Å—è—Ç—å"},{w:"time", ipa:"/ta…™m/", ru:"–≤—Ä–µ–º—è"}]},
  {cat:"consonant", sym:"/d/",  ru:"–∑–≤–æ–Ω–∫–∏–π ¬´–¥¬ª, –∫–æ–Ω—á–∏–∫ —É –∑—É–±–æ–≤", ex:[{w:"day", ipa:"/de…™/", ru:"–¥–µ–Ω—å"},{w:"red", ipa:"/red/", ru:"–∫—Ä–∞—Å–Ω—ã–π"}]},
  {cat:"consonant", sym:"/k/",  ru:"–≥–ª—É—Ö–æ–π ¬´–∫¬ª", ex:[{w:"cat", ipa:"/k√¶t/", ru:"–∫–æ—Ç"},{w:"back", ipa:"/b√¶k/", ru:"–Ω–∞–∑–∞–¥/—Å–ø–∏–Ω–∞"}]},
  {cat:"consonant", sym:"/…°/",  ru:"–∑–≤–æ–Ω–∫–∏–π ¬´–≥¬ª", ex:[{w:"go", ipa:"/g…ô ä/", ru:"–∏–¥—Ç–∏"},{w:"big", ipa:"/b…™…°/", ru:"–±–æ–ª—å—à–æ–π"}]},
  {cat:"consonant", sym:"/f/",  ru:"–≥—É–±–Ω–æ-–∑—É–±–Ω–æ–π ¬´—Ñ¬ª", ex:[{w:"fish", ipa:"/f…™ É/", ru:"—Ä—ã–±–∞"},{w:"coffee", ipa:"/Ààk…ífi/", ru:"–∫–æ—Ñ–µ"}]},
  {cat:"consonant", sym:"/v/",  ru:"–∑–≤–æ–Ω–∫–∏–π ¬´–≤¬ª", ex:[{w:"five", ipa:"/fa…™v/", ru:"–ø—è—Ç—å"},{w:"very", ipa:"/Ààveri/", ru:"–æ—á–µ–Ω—å"}]},
  {cat:"consonant", sym:"/Œ∏/",  ru:"–≥–ª—É—Ö–æ–π –º–µ–∂–∑—É–±–Ω—ã–π: —è–∑—ã–∫ –º–µ–∂–¥—É –∑—É–±–∞–º–∏", ex:[{w:"think", ipa:"/Œ∏…™≈ãk/", ru:"–¥—É–º–∞—Ç—å"},{w:"thanks", ipa:"/Œ∏√¶≈ãks/", ru:"—Å–ø–∞—Å–∏–±–æ"}]},
  {cat:"consonant", sym:"/√∞/",  ru:"–∑–≤–æ–Ω–∫–∏–π –º–µ–∂–∑—É–±–Ω—ã–π", ex:[{w:"this", ipa:"/√∞…™s/", ru:"—ç—Ç–æ—Ç"},{w:"mother", ipa:"/Ààm å√∞…ô/", ru:"–º–∞–º–∞"}]},
  {cat:"consonant", sym:"/s/",  ru:"–≥–ª—É—Ö–æ–π ¬´—Å¬ª", ex:[{w:"see", ipa:"/siÀê/", ru:"–≤–∏–¥–µ—Ç—å"},{w:"bus", ipa:"/b ås/", ru:"–∞–≤—Ç–æ–±—É—Å"}]},
  {cat:"consonant", sym:"/z/",  ru:"–∑–≤–æ–Ω–∫–∏–π ¬´–∑¬ª", ex:[{w:"zoo", ipa:"/zuÀê/", ru:"–∑–æ–æ–ø–∞—Ä–∫"},{w:"busy", ipa:"/Ààb…™zi/", ru:"–∑–∞–Ω—è—Ç–æ–π"}]},
  {cat:"consonant", sym:"/ É/",  ru:"–≥–ª—É—Ö–æ–π ¬´—à¬ª", ex:[{w:"she", ipa:"/ ÉiÀê/", ru:"–æ–Ω–∞"},{w:"fish", ipa:"/f…™ É/", ru:"—Ä—ã–±–∞"}]},
  {cat:"consonant", sym:"/ í/",  ru:"–∑–≤–æ–Ω–∫–∏–π ¬´–∂¬ª (–∑–∞–∏–º—Å—Ç–≤.)", ex:[{w:"vision", ipa:"/Ààv…™ í…ôn/", ru:"–∑—Ä–µ–Ω–∏–µ"},{w:"measure", ipa:"/Ààme í…ô/", ru:"–º–µ—Ä–∞"}]},
  {cat:"consonant", sym:"/h/",  ru:"–≤—ã–¥–æ—Ö ¬´—Ö/—Ö—ä¬ª", ex:[{w:"hot", ipa:"/h…ít/", ru:"–≥–æ—Ä—è—á–∏–π"},{w:"house", ipa:"/ha äs/", ru:"–¥–æ–º"}]},
  {cat:"consonant", sym:"/t É/", ru:"–∫–∞–∫ ¬´—á¬ª", ex:[{w:"chair", ipa:"/t Ée…ô/", ru:"—Å—Ç—É–ª"},{w:"teacher", ipa:"/ÀàtiÀêt É…ô/", ru:"—É—á–∏—Ç–µ–ª—å"}]},
  {cat:"consonant", sym:"/d í/", ru:"–∫–∞–∫ ¬´–¥–∂¬ª", ex:[{w:"jam", ipa:"/d í√¶m/", ru:"–≤–∞—Ä–µ–Ω—å–µ"},{w:"orange", ipa:"/Àà…ír…™nd í/", ru:"–∞–ø–µ–ª—å—Å–∏–Ω"}]},
  {cat:"consonant", sym:"/m/",  ru:"–Ω–æ—Å–æ–≤–æ–π ¬´–º¬ª", ex:[{w:"man", ipa:"/m√¶n/", ru:"–º—É–∂—á–∏–Ω–∞"},{w:"time", ipa:"/ta…™m/", ru:"–≤—Ä–µ–º—è"}]},
  {cat:"consonant", sym:"/n/",  ru:"–Ω–æ—Å–æ–≤–æ–π ¬´–Ω¬ª", ex:[{w:"no", ipa:"/n…ô ä/", ru:"–Ω–µ—Ç"},{w:"ten", ipa:"/ten/", ru:"–¥–µ—Å—è—Ç—å"}]},
  {cat:"consonant", sym:"/≈ã/",  ru:"–Ω–æ—Å–æ–≤–æ–π –∑–∞–¥–Ω–µ—è–∑—ã—á–Ω—ã–π (–∫–∞–∫ ¬´–Ω–≥¬ª)", ex:[{w:"sing", ipa:"/s…™≈ã/", ru:"–ø–µ—Ç—å"},{w:"long", ipa:"/l…í≈ã/", ru:"–¥–ª–∏–Ω–Ω—ã–π"}]},
  {cat:"consonant", sym:"/l/",  ru:"–∞–Ω–≥–ª–∏–π—Å–∫–∏–π ¬´–ª¬ª (—á–∞—Å—Ç–æ –∑–∞—Ç–µ–º–Ω—ë–Ω–Ω—ã–π)", ex:[{w:"look", ipa:"/l äk/", ru:"—Å–º–æ—Ç—Ä–µ—Ç—å"},{w:"feel", ipa:"/fiÀêl/", ru:"—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å"}]},
  {cat:"consonant", sym:"/r/",  ru:"–∞–Ω–≥–ª. ¬´—Ä¬ª, –Ω–µ —Ç—Ä—ë–º", ex:[{w:"red", ipa:"/red/", ru:"–∫—Ä–∞—Å–Ω—ã–π"},{w:"car", ipa:"/k…ëÀê/", ru:"–º–∞—à–∏–Ω–∞"}]},
  {cat:"consonant", sym:"/j/",  ru:"–∫–∞–∫ ¬´–π¬ª", ex:[{w:"you", ipa:"/juÀê/", ru:"—Ç—ã/–≤—ã"},{w:"yes", ipa:"/jes/", ru:"–¥–∞"}]},
  {cat:"consonant", sym:"/w/",  ru:"–≥—É–±–Ω–æ-–≥—É–±–Ω–æ–π –ø–æ–ª—É–≥–ª–∞—Å–Ω—ã–π", ex:[{w:"we", ipa:"/wiÀê/", ru:"–º—ã"},{w:"wet", ipa:"/wet/", ru:"–º–æ–∫—Ä—ã–π"}]},
];

/***************** DATA: ALPHABET (emoji images + IPA) *****************/
const ABC = [
  {L:'A', name:'/e…™/', w:[{e:'apple', ipa:'/Àà√¶p…ôl/', ru:'—è–±–ª–æ–∫–æ', img:'üçé'},{e:'ant', ipa:'/√¶nt/', ru:'–º—É—Ä–∞–≤–µ–π', img:'üêú'}]},
  {L:'B', name:'/biÀê/', w:[{e:'ball', ipa:'/b…îÀêl/', ru:'–º—è—á', img:'‚öΩ'},{e:'bird', ipa:'/b…úÀêd/', ru:'–ø—Ç–∏—Ü–∞', img:'üê¶'}]},
  {L:'C', name:'/siÀê/', w:[{e:'cat', ipa:'/k√¶t/', ru:'–∫–æ—Ç', img:'üê±'},{e:'cake', ipa:'/ke…™k/', ru:'—Ç–æ—Ä—Ç', img:'üéÇ'}]},
  {L:'D', name:'/diÀê/', w:[{e:'dog', ipa:'/d…í…°/', ru:'—Å–æ–±–∞–∫–∞', img:'üê∂'},{e:'door', ipa:'/d…îÀê/', ru:'–¥–≤–µ—Ä—å', img:'üö™'}]},
  {L:'E', name:'/iÀê/', w:[{e:'egg', ipa:'/e…°/', ru:'—è–π—Ü–æ', img:'ü•ö'},{e:'elephant', ipa:'/Ààel…™f…ônt/', ru:'—Å–ª–æ–Ω', img:'üêò'}]},
  {L:'F', name:'/ef/', w:[{e:'fish', ipa:'/f…™ É/', ru:'—Ä—ã–±–∞', img:'üêü'},{e:'frog', ipa:'/fr…í…°/', ru:'–ª—è–≥—É—à–∫–∞', img:'üê∏'}]},
  {L:'G', name:'/d íiÀê/', w:[{e:'goat', ipa:'/g…ô ät/', ru:'–∫–æ–∑—ë–ª', img:'üêê'},{e:'grapes', ipa:'/…°re…™ps/', ru:'–≤–∏–Ω–æ–≥—Ä–∞–¥', img:'üçá'}]},
  {L:'H', name:'/e…™t É/', w:[{e:'hat', ipa:'/h√¶t/', ru:'—à–ª—è–ø–∞', img:'üé©'},{e:'house', ipa:'/ha äs/', ru:'–¥–æ–º', img:'üè†'}]},
  {L:'I', name:'/a…™/', w:[{e:'ice', ipa:'/a…™s/', ru:'–ª—ë–¥', img:'üßä'},{e:'insect', ipa:'/Àà…™nsekt/', ru:'–Ω–∞—Å–µ–∫–æ–º–æ–µ', img:'üêû'}]},
  {L:'J', name:'/d íe…™/', w:[{e:'juice', ipa:'/d íuÀês/', ru:'—Å–æ–∫', img:'üßÉ'},{e:'jelly', ipa:'/Ààd íeli/', ru:'–∂–µ–ª–µ', img:'üçÆ'}]},
  {L:'K', name:'/ke…™/', w:[{e:'kite', ipa:'/ka…™t/', ru:'–≤–æ–∑–¥—É—à–Ω—ã–π –∑–º–µ–π', img:'ü™Å'},{e:'key', ipa:'/kiÀê/', ru:'–∫–ª—é—á', img:'üîë'}]},
  {L:'L', name:'/el/', w:[{e:'lion', ipa:'/Ààla…™…ôn/', ru:'–ª–µ–≤', img:'ü¶Å'},{e:'leaf', ipa:'/liÀêf/', ru:'–ª–∏—Å—Ç', img:'üçÉ'}]},
  {L:'M', name:'/em/', w:[{e:'moon', ipa:'/muÀên/', ru:'–ª—É–Ω–∞', img:'üåô'},{e:'milk', ipa:'/m…™lk/', ru:'–º–æ–ª–æ–∫–æ', img:'ü•õ'}]},
  {L:'N', name:'/en/', w:[{e:'nose', ipa:'/n…ô äz/', ru:'–Ω–æ—Å', img:'üëÉ'},{e:'nest', ipa:'/nest/', ru:'–≥–Ω–µ–∑–¥–æ', img:'ü™∫'}]},
  {L:'O', name:'/…ô ä/ ~ /o ä/', w:[{e:'orange', ipa:'/Àà…ír…™nd í/', ru:'–∞–ø–µ–ª—å—Å–∏–Ω', img:'üçä'},{e:'octopus', ipa:'/Àà…íkt…ôp…ôs/', ru:'–æ—Å—å–º–∏–Ω–æ–≥', img:'üêô'}]},
  {L:'P', name:'/piÀê/', w:[{e:'panda', ipa:'/Ààp√¶nd…ô/', ru:'–ø–∞–Ω–¥–∞', img:'üêº'},{e:'pen', ipa:'/pen/', ru:'—Ä—É—á–∫–∞', img:'üñäÔ∏è'}]},
  {L:'Q', name:'/kjuÀê/', w:[{e:'queen', ipa:'/kwiÀên/', ru:'–∫–æ—Ä–æ–ª–µ–≤–∞', img:'üëë'},{e:'question', ipa:'/Ààkwest É…ôn/', ru:'–≤–æ–ø—Ä–æ—Å', img:'‚ùì'}]},
  {L:'R', name:'/…ëÀê(r)/', w:[{e:'rain', ipa:'/re…™n/', ru:'–¥–æ–∂–¥—å', img:'üåßÔ∏è'},{e:'robot', ipa:'/Ààr…ô äb…ít/', ru:'—Ä–æ–±–æ—Ç', img:'ü§ñ'}]},
  {L:'S', name:'/es/', w:[{e:'sun', ipa:'/s ån/', ru:'—Å–æ–ª–Ω—Ü–µ', img:'‚òÄÔ∏è'},{e:'star', ipa:'/st…ëÀê/', ru:'–∑–≤–µ–∑–¥–∞', img:'‚≠ê'}]},
  {L:'T', name:'/tiÀê/', w:[{e:'tiger', ipa:'/Ààta…™…°…ô/', ru:'—Ç–∏–≥—Ä', img:'üêØ'},{e:'tree', ipa:'/triÀê/', ru:'–¥–µ—Ä–µ–≤–æ', img:'üå≥'}]},
  {L:'U', name:'/juÀê/', w:[{e:'umbrella', ipa:'/ åmÀàbrel…ô/', ru:'–∑–æ–Ω—Ç', img:'‚òÇÔ∏è'},{e:'unicorn', ipa:'/ÀàjuÀên…™k…îÀên/', ru:'–µ–¥–∏–Ω–æ—Ä–æ–≥', img:'ü¶Ñ'}]},
  {L:'V', name:'/viÀê/', w:[{e:'violin', ipa:'/Àåva…™…ôÀàl…™n/', ru:'—Å–∫—Ä–∏–ø–∫–∞', img:'üéª'},{e:'van', ipa:'/v√¶n/', ru:'—Ñ—É—Ä–≥–æ–Ω', img:'üöê'}]},
  {L:'W', name:'/Ààd åb…ôl.juÀê/', w:[{e:'whale', ipa:'/we…™l/', ru:'–∫–∏—Ç', img:'üêã'},{e:'water', ipa:'/Ààw…îÀêt…ô/', ru:'–≤–æ–¥–∞', img:'üíß'}]},
  {L:'X', name:'/eks/', w:[{e:'x-ray', ipa:'/Ààeksre…™/', ru:'—Ä–µ–Ω—Ç–≥–µ–Ω', img:'ü©ª'},{e:'box', ipa:'/b…íks/', ru:'–∫–æ—Ä–æ–±–∫–∞', img:'üì¶'}]},
  {L:'Y', name:'/wa…™/', w:[{e:'yogurt', ipa:'/Ààj…í…°…ôt/', ru:'–π–æ–≥—É—Ä—Ç', img:'ü•£'},{e:'yoyo', ipa:'/Ààj…ô äj…ô ä/', ru:'–π–æ-–π–æ', img:'ü™Ä'}]},
  {L:'Z', name:'/zed/ (BrE) ~ /ziÀê/ (AmE)', w:[{e:'zebra', ipa:'/Ààzebr…ô/', ru:'–∑–µ–±—Ä–∞', img:'ü¶ì'},{e:'zoo', ipa:'/zuÀê/', ru:'–∑–æ–æ–ø–∞—Ä–∫', img:'ü¶í'}]},
];

/***************** RENDER: IPA *****************/
const cardsEl = document.getElementById('cards');
const searchEl = document.getElementById('search');
const chips = [...document.querySelectorAll('.chip')];
const resetBtn = document.getElementById('resetFilters');
const shuffleBtn = document.getElementById('shuffle');
const ttsBtn = document.getElementById('ttsTest');
const quizIpaEl = document.getElementById('quizIpa');
const toggleQuizIpaBtn = document.getElementById('toggleQuizIpa');

let state = {filter:'all', query:''};

function renderIPA(){
  const q = state.query.trim().toLowerCase();
  cardsEl.innerHTML = '';
  let list = IPA.filter(x => state.filter==='all' || x.cat===state.filter);
  if(q){
    list = list.filter(x =>
      x.sym.toLowerCase().includes(q) ||
      x.ru.toLowerCase().includes(q) ||
      x.ex.some(e => (e.w+e.ru+e.ipa).toLowerCase().includes(q))
    );
  }
  for(const x of list){
    const card = document.createElement('article');
    card.className='card';
    card.innerHTML = `
      <div class="pill" style="justify-content:space-between;display:flex;width:100%">
        <div class="ipa" aria-label="IPA symbol">${x.sym}</div>
        <span class="tag">${x.cat}</span>
      </div>
      <div class="ru">${x.ru}</div>
      <div class="examples">
        ${x.ex.map(e=>`
          <div class="ex">
            <button class="btn" data-say="${e.w}" title="–ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏">üîä</button>
            <div>
              <div><b>${e.w}</b> <span class="muted">${e.ipa}</span></div>
              <div class="muted">${e.ru}</div>
            </div>
          </div>
        `).join('')}
      </div>
    `;
    cardsEl.appendChild(card);
  }
  attachSayHandlers();
}

function attachSayHandlers(){
  cardsEl.querySelectorAll('button[data-say]').forEach(btn=>{
    btn.onclick = ()=>speak(btn.getAttribute('data-say'));
  });
}

chips.forEach(ch=>{
  ch.onclick = ()=>{
    chips.forEach(c=>c.classList.remove('active'));
    ch.classList.add('active');
    state.filter = ch.dataset.filter;
    renderIPA();
  };
});
resetBtn.onclick = ()=>{
  state.filter='all'; state.query=''; searchEl.value='';
  chips.forEach(c=>c.classList.toggle('active', c.dataset.filter==='all'));
  renderIPA();
};
searchEl.addEventListener('input', e=>{ state.query = e.target.value; renderIPA(); });
shuffleBtn.onclick = ()=>{
  for(let i=IPA.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [IPA[i],IPA[j]]=[IPA[j],IPA[i]]; }
  renderIPA();
};

/***************** TTS *****************/
function speak(text){
  if(!('speechSynthesis' in window)){ alert('–£–ø—Å! –í —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ –Ω–µ—Ç TTS. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ Chrome/Edge/Safari.'); return; }
  const u = new SpeechSynthesisUtterance(text);
  const pickVoice = ()=>{
    const voices = window.speechSynthesis.getVoices();
    let v = voices.find(v=>/en-GB/i.test(v.lang)) || voices.find(v=>/en-US/i.test(v.lang)) || voices.find(v=>/en/i.test(v.lang));
    if(v) u.voice = v;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
  };
  if(window.speechSynthesis.getVoices().length===0){ window.speechSynthesis.onvoiceschanged = pickVoice; }
  else { pickVoice(); }
}
ttsBtn.onclick = ()=>speak('English pronunciation test');

/***************** QUIZ: IPA *****************/
const qSymbol = document.getElementById('qSymbol');
const qTag = document.getElementById('qTag');
const qTip = document.getElementById('qTip');
const qProgress = document.getElementById('qProgress');
const answersEl = document.getElementById('answers');
const qSkip = document.getElementById('qSkip');
const qNext = document.getElementById('qNext');
const modeIpa = document.getElementById('modeIpa');

let quiz = {order:[], idx:0, score:0, active:false};

function startQuizIPA(){
  quiz.active = true; quiz.idx = 0; quiz.score=0;
  const pool = [...IPA];
  for(let i=pool.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [pool[i],pool[j]]=[pool[j],pool[i]]; }
  quiz.order = pool.slice(0,10);
  quizIpaEl.style.display='block';
  window.scrollTo({top:quizIpaEl.offsetTop-10, behavior:'smooth'});
  showQuestionIPA();
}
function endQuizIPA(){
  quizIpaEl.style.display='block';
  qSymbol.textContent = '–ì–æ—Ç–æ–≤–æ!';
  qTag.textContent = '—Ä–µ–∑—É–ª—å—Ç–∞—Ç';
  qTip.innerHTML = `–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <b>${quiz.score}</b> –∏–∑ 10. –ù–∞–∂–º–∏—Ç–µ ¬´–î–∞–ª—å—à–µ¬ª, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.`;
  answersEl.innerHTML='';
  qProgress.textContent = '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
  qNext.onclick = ()=>startQuizIPA();
  qSkip.style.display='none';
}
function pickAnswersIPA(correct){
  const others = IPA.filter(x=>x!==correct);
  const opts = [];
  while(opts.length<3 && others.length){
    const r = others.splice(Math.floor(Math.random()*others.length),1)[0];
    if(modeIpa.value==='word'){
      const e = r.ex[Math.floor(Math.random()*r.ex.length)];
      opts.push({label:`<b>${e.w}</b> <span class="muted">${e.ipa||''}</span>`, ok:false});
    } else {
      opts.push({label:`<b>${r.sym}</b> <span class="muted">${r.cat}</span>`, ok:false});
    }
  }
  if(modeIpa.value==='word'){
    const right = correct.ex[Math.floor(Math.random()*correct.ex.length)];
    opts.push({label:`<b>${right.w}</b> <span class="muted">${right.ipa||''}</span>`, ok:true});
  } else {
    opts.push({label:`<b>${correct.sym}</b> <span class="muted">${correct.cat}</span>`, ok:true});
  }
  for(let i=opts.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [opts[i],opts[j]]=[opts[j],opts[i]]; }
  return opts;
}
function showQuestionIPA(){
  if(quiz.idx>=quiz.order.length){ endQuizIPA(); return; }
  const x = quiz.order[quiz.idx];
  qSymbol.textContent = modeIpa.value==='word' ? x.sym : (x.ex[0].w);
  qTag.textContent = x.cat; qTip.textContent = x.ru;
  qProgress.textContent = `–í–æ–ø—Ä–æ—Å ${quiz.idx+1} –∏–∑ ${quiz.order.length}`;
  const choices = pickAnswersIPA(x);
  answersEl.innerHTML = choices.map(c=>`<button class="ans" data-ok="${c.ok?1:0}">${c.label}</button>`).join('');
  const buttons = [...answersEl.querySelectorAll('.ans')];
  const correctBtn = buttons.find(b=>b.getAttribute('data-ok')==='1');
  buttons.forEach(btn=>{
    btn.onclick = ()=>{
      const ok = btn.getAttribute('data-ok')==='1';
      if(ok){ btn.classList.add('correct'); }
      else { btn.classList.add('wrong'); correctBtn.classList.add('correct'); }
      if(ok) quiz.score++;
      buttons.forEach(b=>b.disabled=true);
    };
  });
  qSkip.style.display='inline-block';
  qNext.onclick = ()=>{ quiz.idx++; showQuestionIPA(); };
  qSkip.onclick = ()=>{ quiz.idx++; showQuestionIPA(); };
}

/***************** RENDER: ALPHABET *****************/
const abcCardsEl = document.getElementById('abcCards');
const searchAbcEl = document.getElementById('searchAbc');
const quizAbcEl = document.getElementById('quizAbc');
const toggleQuizAbcBtn = document.getElementById('toggleQuizAbc');

function renderABC(){
  const q = (searchAbcEl.value||'').trim().toLowerCase();
  abcCardsEl.innerHTML = '';
  let list = ABC;
  if(q){
    list = list.filter(x => x.L.toLowerCase().includes(q) || x.w.some(o => (o.e+o.ru).toLowerCase().includes(q)));
  }
  for(const x of list){
    const card = document.createElement('article');
    card.className='card';
    card.innerHTML = `
      <div class="pill" style="justify-content:space-between;display:flex;width:100%">
        <button class="letter btn" data-say-letter="${x.L}" aria-label="–ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ –±—É–∫–≤—É ${x.L}" title="–ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ –±—É–∫–≤—É">${x.L}</button>
        <span class="tag">name: ${x.name}</span>
      </div>
      <div class="imgbox">
        ${x.w.map(o=>`
          <div class="ex" style="min-width:46%">
            <div class="emoji" aria-hidden="true">${o.img}</div>
            <div>
              <div><b>${o.e}</b> <span class="muted">${o.ipa||''}</span></div>
              <div class="wru">${o.ru}</div>
            </div>
          </div>
        `).join('')}
      </div>
      <div class="muted">–°–æ–≤–µ—Ç: –ø—Ä–æ–∏–∑–Ω–µ—Å–∏—Ç–µ –±—É–∫–≤—É ¬´${x.L}¬ª (${x.name}) –∏ —Å–ª–æ–≤–∞ ‚Äî –Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —É—Å–ª—ã—à–∞—Ç—å.</div>
      <div class="examples">
        <button class="btn" data-say="${x.L}">üîä ${x.L}</button>
        ${x.w.map(o=>`<button class="btn" data-say="${o.e}">üîä ${o.e}</button>`).join('')}
      </div>
    `;
    abcCardsEl.appendChild(card);
  }
  // TTS for words & letters
  abcCardsEl.querySelectorAll('[data-say]').forEach(btn=>{
    btn.onclick = ()=>speak(btn.getAttribute('data-say'));
  });
  abcCardsEl.querySelectorAll('[data-say-letter]').forEach(btn=>{
    btn.onclick = ()=>speak(btn.getAttribute('data-say-letter'));
  });
}
searchAbcEl.addEventListener('input', renderABC);

/***************** QUIZ: ALPHABET *****************/
const aSymbol = document.getElementById('aSymbol');
const aTip = document.getElementById('aTip');
const aProgress = document.getElementById('aProgress');
const aAnswers = document.getElementById('aAnswers');
const aSkip = document.getElementById('aSkip');
const aNext = document.getElementById('aNext');
const modeAbc = document.getElementById('modeAbc');

let aQuiz = {order:[], idx:0, score:0, active:false};

function startQuizABC(){
  aQuiz.active = true; aQuiz.idx = 0; aQuiz.score=0;
  const pool = [...ABC];
  for(let i=pool.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [pool[i],pool[j]]=[pool[j],pool[i]]; }
  aQuiz.order = pool.slice(0,10);
  quizAbcEl.style.display='block';
  window.scrollTo({top:quizAbcEl.offsetTop-10, behavior:'smooth'});
  showQuestionABC();
}
function endQuizABC(){
  quizAbcEl.style.display='block';
  aSymbol.textContent = '–ì–æ—Ç–æ–≤–æ!';
  aTip.innerHTML = `–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <b>${aQuiz.score}</b> –∏–∑ 10. –ù–∞–∂–º–∏—Ç–µ ¬´–î–∞–ª—å—à–µ¬ª, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.`;
  aAnswers.innerHTML='';
  aProgress.textContent = '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
  aNext.onclick = ()=>startQuizABC();
  aSkip.style.display='none';
}
function pickAnswersABC(correct){
  const others = ABC.filter(x=>x!==correct);
  const choices = [];
  while(choices.length<3 && others.length){
    const r = others.splice(Math.floor(Math.random()*others.length),1)[0];
    if(modeAbc.value==='pickWord'){
      const e = r.w[Math.floor(Math.random()*r.w.length)];
      choices.push({label:`${e.img} <b>${e.e}</b> <span class="muted">${e.ipa||''}</span>`, ok:false});
    } else {
      choices.push({label:`<b>${r.L}</b>`, ok:false});
    }
  }
  if(modeAbc.value==='pickWord'){
    const right = correct.w[Math.floor(Math.random()*correct.w.length)];
    choices.push({label:`${right.img} <b>${right.e}</b> <span class="muted">${right.ipa||''}</span>`, ok:true});
  } else {
    choices.push({label:`<b>${correct.L}</b>`, ok:true});
  }
  for(let i=choices.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [choices[i],choices[j]]=[choices[j],choices[i]]; }
  return choices;
}
function showQuestionABC(){
  if(aQuiz.idx>=aQuiz.order.length){ endQuizABC(); return; }
  const x = aQuiz.order[aQuiz.idx];
  aSymbol.textContent = modeAbc.value==='pickWord' ? x.L : x.w[0].e;
  aTip.textContent = modeAbc.value==='pickWord' ? `–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–æ, –Ω–∞—á–∏–Ω–∞—é—â–µ–µ—Å—è –Ω–∞ ¬´${x.L}¬ª` : `–í—ã–±–µ—Ä–∏—Ç–µ –±—É–∫–≤—É, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è ¬´${x.w[0].e}¬ª`;
  aProgress.textContent = `–í–æ–ø—Ä–æ—Å ${aQuiz.idx+1} –∏–∑ ${aQuiz.order.length}`;
  const choices = pickAnswersABC(x);
  aAnswers.innerHTML = choices.map(c=>`<button class="ans" data-ok="${c.ok?1:0}">${c.label}</button>`).join('');
  const buttons = [...aAnswers.querySelectorAll('.ans')];
  const correctBtn = buttons.find(b=>b.getAttribute('data-ok')==='1');
  buttons.forEach(btn=>{
    btn.onclick = ()=>{
      const ok = btn.getAttribute('data-ok')==='1';
      if(ok){ btn.classList.add('correct'); }
      else { btn.classList.add('wrong'); correctBtn.classList.add('correct'); }
      if(ok) aQuiz.score++;
      buttons.forEach(b=>b.disabled=true);
    };
  });
  aSkip.style.display='inline-block';
  aNext.onclick = ()=>{ aQuiz.idx++; showQuestionABC(); };
  aSkip.onclick = ()=>{ aQuiz.idx++; showQuestionABC(); };
}

/***************** HEADER BUTTON BINDINGS *****************/
const tabIpa = document.getElementById('tabIpa');
const tabAbc = document.getElementById('tabAbc');
const secIpa = document.getElementById('secIpa');
const secAbc = document.getElementById('secAbc');
const toggleQuizAbcHeader = document.getElementById('toggleQuizAbc');

function activate(tab){
  if(tab==='ipa'){
    tabIpa.classList.add('active'); tabIpa.setAttribute('aria-selected','true');
    tabAbc.classList.remove('active'); tabAbc.setAttribute('aria-selected','false');
    secIpa.classList.add('active'); secAbc.classList.remove('active');
  } else {
    tabAbc.classList.add('active'); tabAbc.setAttribute('aria-selected','true');
    tabIpa.classList.remove('active'); tabIpa.setAttribute('aria-selected','false');
    secAbc.classList.add('active'); secIpa.classList.remove('active');
  }
}
tabIpa.onclick = ()=>activate('ipa');
tabAbc.onclick = ()=>activate('abc');

toggleQuizIpaBtn.onclick = ()=>{
  if(!quiz.active){ startQuizIPA(); toggleQuizIpaBtn.classList.add('active'); }
  else { quiz.active=false; quizIpaEl.style.display='none'; toggleQuizIpaBtn.classList.remove('active'); }
};
toggleQuizAbcHeader.onclick = ()=>{
  if(!aQuiz.active){ startQuizABC(); toggleQuizAbcHeader.classList.add('active'); }
  else { aQuiz.active=false; quizAbcEl.style.display='none'; toggleQuizAbcHeader.classList.remove('active'); }
};

/***************** INIT *****************/
renderIPA();
renderABC();
</script>
</body>
</html>
