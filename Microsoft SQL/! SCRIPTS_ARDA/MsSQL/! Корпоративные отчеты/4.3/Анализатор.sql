--На начало - Комплектация товара (Компл):
INSERT INTO [AzTempDB].[CONST\rumyantsev].[v_014_00025_1_CONST\rumyantsev] ([DocDate], [OurID], [StockID], [StockGID], [StockGName], [PCatID], [PCatName], [PGrID], [PGrName], [PGrID1], [PGrName1], [PGrID2], [PGrName2], [PGrID3], [PGrName3], [ProdID], [ProdName], [Notes], [Country], [Article2], [Article3], [AmortName], [AmortID], [PGrID4], [PGrID5], [PGrName4], [PGrName5], [DepName], [DepID], [TNotes], [GMSSourceGroup], [SumQty], [SumCost]) SELECT CAST('20181101' as smalldatetime), t_SRec_224.OurID, t_SRec_224.StockID, r_StockGs_242.StockGID, r_StockGs_242.StockGName, r_Prods_230.PCatID, r_ProdC_233.PCatName, r_Prods_230.PGrID, r_ProdG_231.PGrName, r_Prods_230.PGrID1, r_ProdG1_234.PGrName1, r_Prods_230.PGrID2, r_ProdG2_235.PGrName2, r_Prods_230.PGrID3, r_ProdG3_236.PGrName3, t_SRecA_228.ProdID, r_Prods_230.ProdName, r_Prods_230.Notes, r_Prods_230.Country, r_Prods_230.Article2, r_Prods_230.Article3, at_r_ProdsAmort_232.AmortName, at_r_ProdsAmort_232.AmortID, r_Prods_230.PGrID4, r_Prods_230.PGrID5, at_r_ProdG4_237.PGrName4, at_r_ProdG5_238.PGrName5, r_Deps_241.DepName, r_Deps_241.DepID, r_ProdG1_234.Notes TNotes, '             На начало', SUM(t_SRecA_228.Qty) SumQty, SUM(t_SRecA_228.Qty * t_PInP_229.CostMC) SumCost FROM av_t_SRec t_SRec_224 WITH(NOLOCK)
JOIN r_Ours r_Ours_239 WITH(NOLOCK) ON (r_Ours_239.OurID=t_SRec_224.OurID)
JOIN r_Stocks r_Stocks_240 WITH(NOLOCK) ON (r_Stocks_240.StockID=t_SRec_224.StockID)
JOIN av_t_SRecA t_SRecA_228 WITH(NOLOCK) ON (t_SRecA_228.ChID=t_SRec_224.ChID)
JOIN t_PInP t_PInP_229 WITH(NOLOCK) ON (t_PInP_229.PPID=t_SRecA_228.PPID AND t_PInP_229.ProdID=t_SRecA_228.ProdID)
JOIN r_Prods r_Prods_230 WITH(NOLOCK) ON (r_Prods_230.ProdID=t_PInP_229.ProdID)
JOIN at_r_ProdG4 at_r_ProdG4_237 WITH(NOLOCK) ON (at_r_ProdG4_237.PGrID4=r_Prods_230.PGrID4)
JOIN at_r_ProdG5 at_r_ProdG5_238 WITH(NOLOCK) ON (at_r_ProdG5_238.PGrID5=r_Prods_230.PGrID5)
JOIN at_r_ProdsAmort at_r_ProdsAmort_232 WITH(NOLOCK) ON (at_r_ProdsAmort_232.AmortID=r_Prods_230.AmortID)
JOIN r_ProdC r_ProdC_233 WITH(NOLOCK) ON (r_ProdC_233.PCatID=r_Prods_230.PCatID)
JOIN r_ProdG r_ProdG_231 WITH(NOLOCK) ON (r_ProdG_231.PGrID=r_Prods_230.PGrID)
JOIN r_ProdG1 r_ProdG1_234 WITH(NOLOCK) ON (r_ProdG1_234.PGrID1=r_Prods_230.PGrID1)
JOIN r_ProdG2 r_ProdG2_235 WITH(NOLOCK) ON (r_ProdG2_235.PGrID2=r_Prods_230.PGrID2)
JOIN r_ProdG3 r_ProdG3_236 WITH(NOLOCK) ON (r_ProdG3_236.PGrID3=r_Prods_230.PGrID3)
JOIN r_Deps r_Deps_241 WITH(NOLOCK) ON (r_Deps_241.DepID=r_Stocks_240.DepID)
JOIN r_StockGs r_StockGs_242 WITH(NOLOCK) ON (r_StockGs_242.StockGID=r_Stocks_240.StockGID)
  WHERE  ((r_Prods_230.PCatID = 500) OR (r_Prods_230.PCatID = 501)) AND ((t_SRec_224.OurID BETWEEN 1 AND 5) OR (t_SRec_224.OurID = 11)) AND (t_SRec_224.DocDate < '20181101') GROUP BY t_SRec_224.OurID, t_SRec_224.StockID, r_StockGs_242.StockGID, r_StockGs_242.StockGName, r_Prods_230.PCatID, r_ProdC_233.PCatName, r_Prods_230.PGrID, r_ProdG_231.PGrName, r_Prods_230.PGrID1, r_ProdG1_234.PGrName1, r_Prods_230.PGrID2, r_ProdG2_235.PGrName2, r_Prods_230.PGrID3, r_ProdG3_236.PGrName3, t_SRecA_228.ProdID, r_Prods_230.ProdName, r_Prods_230.Notes, r_Prods_230.Country, r_Prods_230.Article2, r_Prods_230.Article3, at_r_ProdsAmort_232.AmortName, at_r_ProdsAmort_232.AmortID, r_Prods_230.PGrID4, r_Prods_230.PGrID5, at_r_ProdG4_237.PGrName4, at_r_ProdG5_238.PGrName5, r_Deps_241.DepName, r_Deps_241.DepID, r_ProdG1_234.Notes


--На начало - Комплектация товара (Сост):
INSERT INTO [AzTempDB].[CONST\rumyantsev].[v_014_00025_1_CONST\rumyantsev] ([DocDate], [OurID], [StockID], [StockGID], [StockGName], [PCatID], [PCatName], [PGrID], [PGrName], [PGrID1], [PGrName1], [PGrID2], [PGrName2], [PGrID3], [PGrName3], [ProdID], [ProdName], [Notes], [Country], [Article2], [Article3], [AmortName], [AmortID], [PGrID4], [PGrID5], [PGrName4], [PGrName5], [DepName], [DepID], [TNotes], [GMSSourceGroup], [SumQty], [SumCost]) SELECT CAST('20181101' as smalldatetime), t_SRec_225.OurID, t_SRec_225.StockID, r_StockGs_258.StockGID, r_StockGs_258.StockGName, r_Prods_246.PCatID, r_ProdC_249.PCatName, r_Prods_246.PGrID, r_ProdG_247.PGrName, r_Prods_246.PGrID1, r_ProdG1_250.PGrName1, r_Prods_246.PGrID2, r_ProdG2_251.PGrName2, r_Prods_246.PGrID3, r_ProdG3_252.PGrName3, t_SRecD_244.SubProdID, r_Prods_246.ProdName, r_Prods_246.Notes, r_Prods_246.Country, r_Prods_246.Article2, r_Prods_246.Article3, at_r_ProdsAmort_248.AmortName, at_r_ProdsAmort_248.AmortID, r_Prods_246.PGrID4, r_Prods_246.PGrID5, at_r_ProdG4_253.PGrName4, at_r_ProdG5_254.PGrName5, r_Deps_257.DepName, r_Deps_257.DepID, r_ProdG1_250.Notes TNotes, '             На начало', SUM(0-(t_SRecD_244.SubQty)) SumQty, SUM(0-(t_SRecD_244.SubQty * t_PInP_245.CostMC)) SumCost FROM av_t_SRec t_SRec_225 WITH(NOLOCK)
JOIN r_Ours r_Ours_255 WITH(NOLOCK) ON (r_Ours_255.OurID=t_SRec_225.OurID)
JOIN r_Stocks r_Stocks_256 WITH(NOLOCK) ON (r_Stocks_256.StockID=t_SRec_225.StockID)
JOIN av_t_SRecA t_SRecA_243 WITH(NOLOCK) ON (t_SRecA_243.ChID=t_SRec_225.ChID)
JOIN av_t_SRecD t_SRecD_244 WITH(NOLOCK) ON (t_SRecD_244.AChID=t_SRecA_243.AChID)
JOIN t_PInP t_PInP_245 WITH(NOLOCK) ON (t_PInP_245.PPID=t_SRecD_244.SubPPID AND t_PInP_245.ProdID=t_SRecD_244.SubProdID)
JOIN r_Prods r_Prods_246 WITH(NOLOCK) ON (r_Prods_246.ProdID=t_PInP_245.ProdID)
JOIN at_r_ProdG4 at_r_ProdG4_253 WITH(NOLOCK) ON (at_r_ProdG4_253.PGrID4=r_Prods_246.PGrID4)
JOIN at_r_ProdG5 at_r_ProdG5_254 WITH(NOLOCK) ON (at_r_ProdG5_254.PGrID5=r_Prods_246.PGrID5)
JOIN at_r_ProdsAmort at_r_ProdsAmort_248 WITH(NOLOCK) ON (at_r_ProdsAmort_248.AmortID=r_Prods_246.AmortID)
JOIN r_ProdC r_ProdC_249 WITH(NOLOCK) ON (r_ProdC_249.PCatID=r_Prods_246.PCatID)
JOIN r_ProdG r_ProdG_247 WITH(NOLOCK) ON (r_ProdG_247.PGrID=r_Prods_246.PGrID)
JOIN r_ProdG1 r_ProdG1_250 WITH(NOLOCK) ON (r_ProdG1_250.PGrID1=r_Prods_246.PGrID1)
JOIN r_ProdG2 r_ProdG2_251 WITH(NOLOCK) ON (r_ProdG2_251.PGrID2=r_Prods_246.PGrID2)
JOIN r_ProdG3 r_ProdG3_252 WITH(NOLOCK) ON (r_ProdG3_252.PGrID3=r_Prods_246.PGrID3)
JOIN r_Deps r_Deps_257 WITH(NOLOCK) ON (r_Deps_257.DepID=r_Stocks_256.DepID)
JOIN r_StockGs r_StockGs_258 WITH(NOLOCK) ON (r_StockGs_258.StockGID=r_Stocks_256.StockGID)
  WHERE  ((r_Prods_246.PCatID = 500) OR (r_Prods_246.PCatID = 501)) AND ((t_SRec_225.OurID BETWEEN 1 AND 5) OR (t_SRec_225.OurID = 11)) AND (t_SRec_225.DocDate < '20181101') GROUP BY t_SRec_225.OurID, t_SRec_225.StockID, r_StockGs_258.StockGID, r_StockGs_258.StockGName, r_Prods_246.PCatID, r_ProdC_249.PCatName, r_Prods_246.PGrID, r_ProdG_247.PGrName, r_Prods_246.PGrID1, r_ProdG1_250.PGrName1, r_Prods_246.PGrID2, r_ProdG2_251.PGrName2, r_Prods_246.PGrID3, r_ProdG3_252.PGrName3, t_SRecD_244.SubProdID, r_Prods_246.ProdName, r_Prods_246.Notes, r_Prods_246.Country, r_Prods_246.Article2, r_Prods_246.Article3, at_r_ProdsAmort_248.AmortName, at_r_ProdsAmort_248.AmortID, r_Prods_246.PGrID4, r_Prods_246.PGrID5, at_r_ProdG4_253.PGrName4, at_r_ProdG5_254.PGrName5, r_Deps_257.DepName, r_Deps_257.DepID, r_ProdG1_250.Notes

--Комплектация - Комплектация товара (Компл):
INSERT INTO [AzTempDB].[CONST\rumyantsev].[v_014_00025_1_CONST\rumyantsev] ([DocDate], [OurID], [StockID], [StockGID], [StockGName], [PCatID], [PCatName], [PGrID], [PGrName], [PGrID1], [PGrName1], [PGrID2], [PGrName2], [PGrID3], [PGrName3], [ProdID], [ProdName], [Notes], [Country], [Article2], [Article3], [AmortName], [AmortID], [PGrID4], [PGrID5], [PGrName4], [PGrName5], [DepName], [DepID], [TNotes], [GMSSourceGroup], [SumQty], [SumCost]) SELECT t_SRec_224.DocDate DocDate, t_SRec_224.OurID, t_SRec_224.StockID, r_StockGs_242.StockGID, r_StockGs_242.StockGName, r_Prods_230.PCatID, r_ProdC_233.PCatName, r_Prods_230.PGrID, r_ProdG_231.PGrName, r_Prods_230.PGrID1, r_ProdG1_234.PGrName1, r_Prods_230.PGrID2, r_ProdG2_235.PGrName2, r_Prods_230.PGrID3, r_ProdG3_236.PGrName3, t_SRecA_228.ProdID, r_Prods_230.ProdName, r_Prods_230.Notes, r_Prods_230.Country, r_Prods_230.Article2, r_Prods_230.Article3, at_r_ProdsAmort_232.AmortName, at_r_ProdsAmort_232.AmortID, r_Prods_230.PGrID4, r_Prods_230.PGrID5, at_r_ProdG4_237.PGrName4, at_r_ProdG5_238.PGrName5, r_Deps_241.DepName, r_Deps_241.DepID, r_ProdG1_234.Notes TNotes, '  Комплектация', SUM(t_SRecA_228.Qty) SumQty, SUM(t_SRecA_228.Qty * t_PInP_229.CostMC) SumCost FROM av_t_SRec t_SRec_224 WITH(NOLOCK)
JOIN r_Ours r_Ours_239 WITH(NOLOCK) ON (r_Ours_239.OurID=t_SRec_224.OurID)
JOIN r_Stocks r_Stocks_240 WITH(NOLOCK) ON (r_Stocks_240.StockID=t_SRec_224.StockID)
JOIN av_t_SRecA t_SRecA_228 WITH(NOLOCK) ON (t_SRecA_228.ChID=t_SRec_224.ChID)
JOIN t_PInP t_PInP_229 WITH(NOLOCK) ON (t_PInP_229.PPID=t_SRecA_228.PPID AND t_PInP_229.ProdID=t_SRecA_228.ProdID)
JOIN r_Prods r_Prods_230 WITH(NOLOCK) ON (r_Prods_230.ProdID=t_PInP_229.ProdID)
JOIN at_r_ProdG4 at_r_ProdG4_237 WITH(NOLOCK) ON (at_r_ProdG4_237.PGrID4=r_Prods_230.PGrID4)
JOIN at_r_ProdG5 at_r_ProdG5_238 WITH(NOLOCK) ON (at_r_ProdG5_238.PGrID5=r_Prods_230.PGrID5)
JOIN at_r_ProdsAmort at_r_ProdsAmort_232 WITH(NOLOCK) ON (at_r_ProdsAmort_232.AmortID=r_Prods_230.AmortID)
JOIN r_ProdC r_ProdC_233 WITH(NOLOCK) ON (r_ProdC_233.PCatID=r_Prods_230.PCatID)
JOIN r_ProdG r_ProdG_231 WITH(NOLOCK) ON (r_ProdG_231.PGrID=r_Prods_230.PGrID)
JOIN r_ProdG1 r_ProdG1_234 WITH(NOLOCK) ON (r_ProdG1_234.PGrID1=r_Prods_230.PGrID1)
JOIN r_ProdG2 r_ProdG2_235 WITH(NOLOCK) ON (r_ProdG2_235.PGrID2=r_Prods_230.PGrID2)
JOIN r_ProdG3 r_ProdG3_236 WITH(NOLOCK) ON (r_ProdG3_236.PGrID3=r_Prods_230.PGrID3)
JOIN r_Deps r_Deps_241 WITH(NOLOCK) ON (r_Deps_241.DepID=r_Stocks_240.DepID)
JOIN r_StockGs r_StockGs_242 WITH(NOLOCK) ON (r_StockGs_242.StockGID=r_Stocks_240.StockGID)
  WHERE  ((r_Prods_230.PCatID = 500) OR (r_Prods_230.PCatID = 501)) AND ((t_SRec_224.OurID BETWEEN 1 AND 5) OR (t_SRec_224.OurID = 11)) AND (t_SRec_224.DocDate BETWEEN '20181101' AND '20191031') GROUP BY t_SRec_224.DocDate, t_SRec_224.OurID, t_SRec_224.StockID, r_StockGs_242.StockGID, r_StockGs_242.StockGName, r_Prods_230.PCatID, r_ProdC_233.PCatName, r_Prods_230.PGrID, r_ProdG_231.PGrName, r_Prods_230.PGrID1, r_ProdG1_234.PGrName1, r_Prods_230.PGrID2, r_ProdG2_235.PGrName2, r_Prods_230.PGrID3, r_ProdG3_236.PGrName3, t_SRecA_228.ProdID, r_Prods_230.ProdName, r_Prods_230.Notes, r_Prods_230.Country, r_Prods_230.Article2, r_Prods_230.Article3, at_r_ProdsAmort_232.AmortName, at_r_ProdsAmort_232.AmortID, r_Prods_230.PGrID4, r_Prods_230.PGrID5, at_r_ProdG4_237.PGrName4, at_r_ProdG5_238.PGrName5, r_Deps_241.DepName, r_Deps_241.DepID, r_ProdG1_234.Notes


--Комплектация - Комплектация товара (Сост):
INSERT INTO [AzTempDB].[CONST\rumyantsev].[v_014_00025_1_CONST\rumyantsev] ([DocDate], [OurID], [StockID], [StockGID], [StockGName], [PCatID], [PCatName], [PGrID], [PGrName], [PGrID1], [PGrName1], [PGrID2], [PGrName2], [PGrID3], [PGrName3], [ProdID], [ProdName], [Notes], [Country], [Article2], [Article3], [AmortName], [AmortID], [PGrID4], [PGrID5], [PGrName4], [PGrName5], [DepName], [DepID], [TNotes], [GMSSourceGroup], [SumQty], [SumCost]) SELECT t_SRec_225.DocDate DocDate, t_SRec_225.OurID, t_SRec_225.StockID, r_StockGs_258.StockGID, r_StockGs_258.StockGName, r_Prods_246.PCatID, r_ProdC_249.PCatName, r_Prods_246.PGrID, r_ProdG_247.PGrName, r_Prods_246.PGrID1, r_ProdG1_250.PGrName1, r_Prods_246.PGrID2, r_ProdG2_251.PGrName2, r_Prods_246.PGrID3, r_ProdG3_252.PGrName3, t_SRecD_244.SubProdID, r_Prods_246.ProdName, r_Prods_246.Notes, r_Prods_246.Country, r_Prods_246.Article2, r_Prods_246.Article3, at_r_ProdsAmort_248.AmortName, at_r_ProdsAmort_248.AmortID, r_Prods_246.PGrID4, r_Prods_246.PGrID5, at_r_ProdG4_253.PGrName4, at_r_ProdG5_254.PGrName5, r_Deps_257.DepName, r_Deps_257.DepID, r_ProdG1_250.Notes TNotes, '  Комплектация', SUM(0-(t_SRecD_244.SubQty)) SumQty, SUM(0-(t_SRecD_244.SubQty * t_PInP_245.CostMC)) SumCost FROM av_t_SRec t_SRec_225 WITH(NOLOCK)
JOIN r_Ours r_Ours_255 WITH(NOLOCK) ON (r_Ours_255.OurID=t_SRec_225.OurID)
JOIN r_Stocks r_Stocks_256 WITH(NOLOCK) ON (r_Stocks_256.StockID=t_SRec_225.StockID)
JOIN av_t_SRecA t_SRecA_243 WITH(NOLOCK) ON (t_SRecA_243.ChID=t_SRec_225.ChID)
JOIN av_t_SRecD t_SRecD_244 WITH(NOLOCK) ON (t_SRecD_244.AChID=t_SRecA_243.AChID)
JOIN t_PInP t_PInP_245 WITH(NOLOCK) ON (t_PInP_245.PPID=t_SRecD_244.SubPPID AND t_PInP_245.ProdID=t_SRecD_244.SubProdID)
JOIN r_Prods r_Prods_246 WITH(NOLOCK) ON (r_Prods_246.ProdID=t_PInP_245.ProdID)
JOIN at_r_ProdG4 at_r_ProdG4_253 WITH(NOLOCK) ON (at_r_ProdG4_253.PGrID4=r_Prods_246.PGrID4)
JOIN at_r_ProdG5 at_r_ProdG5_254 WITH(NOLOCK) ON (at_r_ProdG5_254.PGrID5=r_Prods_246.PGrID5)
JOIN at_r_ProdsAmort at_r_ProdsAmort_248 WITH(NOLOCK) ON (at_r_ProdsAmort_248.AmortID=r_Prods_246.AmortID)
JOIN r_ProdC r_ProdC_249 WITH(NOLOCK) ON (r_ProdC_249.PCatID=r_Prods_246.PCatID)
JOIN r_ProdG r_ProdG_247 WITH(NOLOCK) ON (r_ProdG_247.PGrID=r_Prods_246.PGrID)
JOIN r_ProdG1 r_ProdG1_250 WITH(NOLOCK) ON (r_ProdG1_250.PGrID1=r_Prods_246.PGrID1)
JOIN r_ProdG2 r_ProdG2_251 WITH(NOLOCK) ON (r_ProdG2_251.PGrID2=r_Prods_246.PGrID2)
JOIN r_ProdG3 r_ProdG3_252 WITH(NOLOCK) ON (r_ProdG3_252.PGrID3=r_Prods_246.PGrID3)
JOIN r_Deps r_Deps_257 WITH(NOLOCK) ON (r_Deps_257.DepID=r_Stocks_256.DepID)
JOIN r_StockGs r_StockGs_258 WITH(NOLOCK) ON (r_StockGs_258.StockGID=r_Stocks_256.StockGID)
  WHERE  ((r_Prods_246.PCatID = 500) OR (r_Prods_246.PCatID = 501)) AND ((t_SRec_225.OurID BETWEEN 1 AND 5) OR (t_SRec_225.OurID = 11)) AND (t_SRec_225.DocDate BETWEEN '20181101' AND '20191031') GROUP BY t_SRec_225.DocDate, t_SRec_225.OurID, t_SRec_225.StockID, r_StockGs_258.StockGID, r_StockGs_258.StockGName, r_Prods_246.PCatID, r_ProdC_249.PCatName, r_Prods_246.PGrID, r_ProdG_247.PGrName, r_Prods_246.PGrID1, r_ProdG1_250.PGrName1, r_Prods_246.PGrID2, r_ProdG2_251.PGrName2, r_Prods_246.PGrID3, r_ProdG3_252.PGrName3, t_SRecD_244.SubProdID, r_Prods_246.ProdName, r_Prods_246.Notes, r_Prods_246.Country, r_Prods_246.Article2, r_Prods_246.Article3, at_r_ProdsAmort_248.AmortName, at_r_ProdsAmort_248.AmortID, r_Prods_246.PGrID4, r_Prods_246.PGrID5, at_r_ProdG4_253.PGrName4, at_r_ProdG5_254.PGrName5, r_Deps_257.DepName, r_Deps_257.DepID, r_ProdG1_250.Notes

--На конец - Комплектация товара (Компл):
INSERT INTO [AzTempDB].[CONST\rumyantsev].[v_014_00025_1_CONST\rumyantsev] ([DocDate], [OurID], [StockID], [StockGID], [StockGName], [PCatID], [PCatName], [PGrID], [PGrName], [PGrID1], [PGrName1], [PGrID2], [PGrName2], [PGrID3], [PGrName3], [ProdID], [ProdName], [Notes], [Country], [Article2], [Article3], [AmortName], [AmortID], [PGrID4], [PGrID5], [PGrName4], [PGrName5], [DepName], [DepID], [TNotes], [GMSSourceGroup], [SumQty], [SumCost]) SELECT CAST('20191031' as smalldatetime), t_SRec_224.OurID, t_SRec_224.StockID, r_StockGs_242.StockGID, r_StockGs_242.StockGName, r_Prods_230.PCatID, r_ProdC_233.PCatName, r_Prods_230.PGrID, r_ProdG_231.PGrName, r_Prods_230.PGrID1, r_ProdG1_234.PGrName1, r_Prods_230.PGrID2, r_ProdG2_235.PGrName2, r_Prods_230.PGrID3, r_ProdG3_236.PGrName3, t_SRecA_228.ProdID, r_Prods_230.ProdName, r_Prods_230.Notes, r_Prods_230.Country, r_Prods_230.Article2, r_Prods_230.Article3, at_r_ProdsAmort_232.AmortName, at_r_ProdsAmort_232.AmortID, r_Prods_230.PGrID4, r_Prods_230.PGrID5, at_r_ProdG4_237.PGrName4, at_r_ProdG5_238.PGrName5, r_Deps_241.DepName, r_Deps_241.DepID, r_ProdG1_234.Notes TNotes, 'На конец', SUM(t_SRecA_228.Qty) SumQty, SUM(t_SRecA_228.Qty * t_PInP_229.CostMC) SumCost FROM av_t_SRec t_SRec_224 WITH(NOLOCK)
JOIN r_Ours r_Ours_239 WITH(NOLOCK) ON (r_Ours_239.OurID=t_SRec_224.OurID)
JOIN r_Stocks r_Stocks_240 WITH(NOLOCK) ON (r_Stocks_240.StockID=t_SRec_224.StockID)
JOIN av_t_SRecA t_SRecA_228 WITH(NOLOCK) ON (t_SRecA_228.ChID=t_SRec_224.ChID)
JOIN t_PInP t_PInP_229 WITH(NOLOCK) ON (t_PInP_229.PPID=t_SRecA_228.PPID AND t_PInP_229.ProdID=t_SRecA_228.ProdID)
JOIN r_Prods r_Prods_230 WITH(NOLOCK) ON (r_Prods_230.ProdID=t_PInP_229.ProdID)
JOIN at_r_ProdG4 at_r_ProdG4_237 WITH(NOLOCK) ON (at_r_ProdG4_237.PGrID4=r_Prods_230.PGrID4)
JOIN at_r_ProdG5 at_r_ProdG5_238 WITH(NOLOCK) ON (at_r_ProdG5_238.PGrID5=r_Prods_230.PGrID5)
JOIN at_r_ProdsAmort at_r_ProdsAmort_232 WITH(NOLOCK) ON (at_r_ProdsAmort_232.AmortID=r_Prods_230.AmortID)
JOIN r_ProdC r_ProdC_233 WITH(NOLOCK) ON (r_ProdC_233.PCatID=r_Prods_230.PCatID)
JOIN r_ProdG r_ProdG_231 WITH(NOLOCK) ON (r_ProdG_231.PGrID=r_Prods_230.PGrID)
JOIN r_ProdG1 r_ProdG1_234 WITH(NOLOCK) ON (r_ProdG1_234.PGrID1=r_Prods_230.PGrID1)
JOIN r_ProdG2 r_ProdG2_235 WITH(NOLOCK) ON (r_ProdG2_235.PGrID2=r_Prods_230.PGrID2)
JOIN r_ProdG3 r_ProdG3_236 WITH(NOLOCK) ON (r_ProdG3_236.PGrID3=r_Prods_230.PGrID3)
JOIN r_Deps r_Deps_241 WITH(NOLOCK) ON (r_Deps_241.DepID=r_Stocks_240.DepID)
JOIN r_StockGs r_StockGs_242 WITH(NOLOCK) ON (r_StockGs_242.StockGID=r_Stocks_240.StockGID)
  WHERE  ((r_Prods_230.PCatID = 500) OR (r_Prods_230.PCatID = 501)) AND ((t_SRec_224.OurID BETWEEN 1 AND 5) OR (t_SRec_224.OurID = 11)) AND (t_SRec_224.DocDate <= '20191031') GROUP BY t_SRec_224.OurID, t_SRec_224.StockID, r_StockGs_242.StockGID, r_StockGs_242.StockGName, r_Prods_230.PCatID, r_ProdC_233.PCatName, r_Prods_230.PGrID, r_ProdG_231.PGrName, r_Prods_230.PGrID1, r_ProdG1_234.PGrName1, r_Prods_230.PGrID2, r_ProdG2_235.PGrName2, r_Prods_230.PGrID3, r_ProdG3_236.PGrName3, t_SRecA_228.ProdID, r_Prods_230.ProdName, r_Prods_230.Notes, r_Prods_230.Country, r_Prods_230.Article2, r_Prods_230.Article3, at_r_ProdsAmort_232.AmortName, at_r_ProdsAmort_232.AmortID, r_Prods_230.PGrID4, r_Prods_230.PGrID5, at_r_ProdG4_237.PGrName4, at_r_ProdG5_238.PGrName5, r_Deps_241.DepName, r_Deps_241.DepID, r_ProdG1_234.Notes


--На конец - Комплектация товара (Сост):
INSERT INTO [AzTempDB].[CONST\rumyantsev].[v_014_00025_1_CONST\rumyantsev] ([DocDate], [OurID], [StockID], [StockGID], [StockGName], [PCatID], [PCatName], [PGrID], [PGrName], [PGrID1], [PGrName1], [PGrID2], [PGrName2], [PGrID3], [PGrName3], [ProdID], [ProdName], [Notes], [Country], [Article2], [Article3], [AmortName], [AmortID], [PGrID4], [PGrID5], [PGrName4], [PGrName5], [DepName], [DepID], [TNotes], [GMSSourceGroup], [SumQty], [SumCost]) SELECT CAST('20191031' as smalldatetime), t_SRec_225.OurID, t_SRec_225.StockID, r_StockGs_258.StockGID, r_StockGs_258.StockGName, r_Prods_246.PCatID, r_ProdC_249.PCatName, r_Prods_246.PGrID, r_ProdG_247.PGrName, r_Prods_246.PGrID1, r_ProdG1_250.PGrName1, r_Prods_246.PGrID2, r_ProdG2_251.PGrName2, r_Prods_246.PGrID3, r_ProdG3_252.PGrName3, t_SRecD_244.SubProdID, r_Prods_246.ProdName, r_Prods_246.Notes, r_Prods_246.Country, r_Prods_246.Article2, r_Prods_246.Article3, at_r_ProdsAmort_248.AmortName, at_r_ProdsAmort_248.AmortID, r_Prods_246.PGrID4, r_Prods_246.PGrID5, at_r_ProdG4_253.PGrName4, at_r_ProdG5_254.PGrName5, r_Deps_257.DepName, r_Deps_257.DepID, r_ProdG1_250.Notes TNotes, 'На конец', SUM(0-(t_SRecD_244.SubQty)) SumQty, SUM(0-(t_SRecD_244.SubQty * t_PInP_245.CostMC)) SumCost FROM av_t_SRec t_SRec_225 WITH(NOLOCK)
JOIN r_Ours r_Ours_255 WITH(NOLOCK) ON (r_Ours_255.OurID=t_SRec_225.OurID)
JOIN r_Stocks r_Stocks_256 WITH(NOLOCK) ON (r_Stocks_256.StockID=t_SRec_225.StockID)
JOIN av_t_SRecA t_SRecA_243 WITH(NOLOCK) ON (t_SRecA_243.ChID=t_SRec_225.ChID)
JOIN av_t_SRecD t_SRecD_244 WITH(NOLOCK) ON (t_SRecD_244.AChID=t_SRecA_243.AChID)
JOIN t_PInP t_PInP_245 WITH(NOLOCK) ON (t_PInP_245.PPID=t_SRecD_244.SubPPID AND t_PInP_245.ProdID=t_SRecD_244.SubProdID)
JOIN r_Prods r_Prods_246 WITH(NOLOCK) ON (r_Prods_246.ProdID=t_PInP_245.ProdID)
JOIN at_r_ProdG4 at_r_ProdG4_253 WITH(NOLOCK) ON (at_r_ProdG4_253.PGrID4=r_Prods_246.PGrID4)
JOIN at_r_ProdG5 at_r_ProdG5_254 WITH(NOLOCK) ON (at_r_ProdG5_254.PGrID5=r_Prods_246.PGrID5)
JOIN at_r_ProdsAmort at_r_ProdsAmort_248 WITH(NOLOCK) ON (at_r_ProdsAmort_248.AmortID=r_Prods_246.AmortID)
JOIN r_ProdC r_ProdC_249 WITH(NOLOCK) ON (r_ProdC_249.PCatID=r_Prods_246.PCatID)
JOIN r_ProdG r_ProdG_247 WITH(NOLOCK) ON (r_ProdG_247.PGrID=r_Prods_246.PGrID)
JOIN r_ProdG1 r_ProdG1_250 WITH(NOLOCK) ON (r_ProdG1_250.PGrID1=r_Prods_246.PGrID1)
JOIN r_ProdG2 r_ProdG2_251 WITH(NOLOCK) ON (r_ProdG2_251.PGrID2=r_Prods_246.PGrID2)
JOIN r_ProdG3 r_ProdG3_252 WITH(NOLOCK) ON (r_ProdG3_252.PGrID3=r_Prods_246.PGrID3)
JOIN r_Deps r_Deps_257 WITH(NOLOCK) ON (r_Deps_257.DepID=r_Stocks_256.DepID)
JOIN r_StockGs r_StockGs_258 WITH(NOLOCK) ON (r_StockGs_258.StockGID=r_Stocks_256.StockGID)
  WHERE  ((r_Prods_246.PCatID = 500) OR (r_Prods_246.PCatID = 501)) AND ((t_SRec_225.OurID BETWEEN 1 AND 5) OR (t_SRec_225.OurID = 11)) AND (t_SRec_225.DocDate <= '20191031') GROUP BY t_SRec_225.OurID, t_SRec_225.StockID, r_StockGs_258.StockGID, r_StockGs_258.StockGName, r_Prods_246.PCatID, r_ProdC_249.PCatName, r_Prods_246.PGrID, r_ProdG_247.PGrName, r_Prods_246.PGrID1, r_ProdG1_250.PGrName1, r_Prods_246.PGrID2, r_ProdG2_251.PGrName2, r_Prods_246.PGrID3, r_ProdG3_252.PGrName3, t_SRecD_244.SubProdID, r_Prods_246.ProdName, r_Prods_246.Notes, r_Prods_246.Country, r_Prods_246.Article2, r_Prods_246.Article3, at_r_ProdsAmort_248.AmortName, at_r_ProdsAmort_248.AmortID, r_Prods_246.PGrID4, r_Prods_246.PGrID5, at_r_ProdG4_253.PGrName4, at_r_ProdG5_254.PGrName5, r_Deps_257.DepName, r_Deps_257.DepID, r_ProdG1_250.Notes