--02-Разделить строку длиной до 8000 символов на две части до 4000 символов каждая
/*
Условия:
-MS SQL Server 2008
-строку делить по запятой
-длина части до 4000 символов каждая
-в частях в начале и конце запятых быть не должно
*/

DECLARE @MSG VARCHAR(8000) = '600001,600003-600025,600027-600042,600044,600046-600060,600062-600077,600079-600106,600110-600112,600114,600117,600119,600120,600122-600125,600128-600148,600150-600152,600155-600169,600171,600173-600178,600180-600201,600203-600229,600235,600236,600238,600248-600271,600274-600276,600278,600280,600282-600300,600302-600315,600317,600318,600320-600342,600344-600347,600349,600351-600361,600380,600381,600385,600386,600389,600390,600392-600399,600402-600434,600723,600725,600751,600783,600803,600811,600829,600831,600879,600880,600931,600932,600935,600936,600938,600939,600964,600965,601027,601065,601066,601100-601102,601143,601157,601209,601214,601273,601287,601288,601290-601296,601575-601581,601583-601588,601590,601591,601594-601599,601601,601607-601612,601617-601621,601627-601629,601632,601633,601642,601669,601671-601675,601703,601707,601724-601733,601737,601739,601741-601743,601766,601767,601771-601774,601789,601796,601806,601808,601813,601830,601851-601869,601871-601881,601887,601888,601890-601893,602039,602044-602060,602078,602081,602093,602098,602102-602104,602117-602128,602138,602139,602167-602174,602177-602183,602262,602265-602267,602271,602280,602286,602287,602291,602293-602296,602304,602305,602307,602310-602312,602314,602315,602319-602322,602324-602333,602336,602339,602353-602356,602382-602385,602390,602400,602402,602403,602405-602410,602426-602465,602467-602470,602482,602493-602498,602504-602512,602514-602523,602540,602542,602546-602548,602554-602556,602583,602584,602659,602675,602681,602685,602686,602719-602722,602728-602731,602733-602745,602747,602866-602868,602880-602883,602885,602887,602893,602936,602985,602990,602991,603001-603006,603011,603012,603014,603020,603021,603023,603029,603057,603064-603066,603070-603073,603102,603104,603107,603110,603137,603139,603141,603142,603150,603151,603153,603167,603168,603184,603185,603187,603221,603244,603247,603248,603268-603271,603274,603286-603289,603292,603294,603295,603301-603303,603307,603350,603380,603382,603396,603397,603399,603400,603428,603429,603431,603432,603434,603435,603438,603440,603450,603451,603464,603482,603529,603534,603541,603561,603562,603608,603611,603659-603661,603687,603709-603711,603713-603718,603720-603727,603879-603884,603888,603889,603891,603914,603922,603937,603939,603965,603966,603978-603980,603984,604061,604151,604358,604400-604403,604514-604516,604603,604605-604609,604615-604618,604634,604850,604851,604882,604894-604897,604936,800011,800158,800185-800195,800231,800236-800239,800241-800244,800246-800248,800263,800285-800294,800343-800345,800370-800378,800428-800431,800433-800437,800460-800462,800464-800469,800527,800560-800585,800593-800595,800597,800599,800613,800617,800619-800628,800749,800768,800861,800885,800935,800951,800952,800977,801052,801053,801055,801056,801069,801108,801109,801114,801115,801271,801280,801287-801291,801295-801303,801315,801334,801338,801339,801349,801351,801352,801360,801363,801375,801377,801378,801380,801385-801387,801389,801390,801392,801395,801440,801451-801454,801460,801465-801487,801489-801492,801506-801513,801522-801525,801539,801566-801585,801637-801642,801817-801829,801888,801939-801945,801949,801950,802105-802107,802114,802115,802126,802169-802173,802175-802177,802184-802188,802204,802221-802270,802272,802273,802277-802285,802306,802317-802319,802394,802395,802402,802404,802418,802449,802450,802452,802453,802456-802461,802472-802483,802486,802498-802502,802574-802576,802582,802588,802600-802614,802621,802622,802625,802626,802645,802658-802661,802664,802665,802670-802696,802733-802737,802739,802800,802803,802836,802838,802846-802871,802919-802924,802952-802955,803056,803057,803093,803110,803118-803120,803133,803140,803141,803143,803157-803160,803169-803171,803246,803247,803260-803262,803266-803268,803302,803306,803307,803318-803320,803326-803343,803345-803352,803387-803400,803403-803405,803432-803437,803439,803442-803450,803491,803492,803496,803512,803514,803515,803548-803556,803568,803578,803593,803633,803700-803703,803775,803812-803850'
DECLARE @Part1 VARCHAR(4000)
DECLARE @Part2 VARCHAR(4000)

DECLARE @CHARINDEX INT

SELECT LEN(@MSG) 'Длина строки',@MSG 'Строка'


--Ниже напишите ваши варианты решения данной задачи


IF LEN(@MSG) > 4000
BEGIN
	SELECT @CHARINDEX = 4000 - CHARINDEX(',', REVERSE(SUBSTRING(@MSG,1,4000)))
	SELECT @CHARINDEX 'CHARINDEX'

	SELECT @Part1 = SUBSTRING(@MSG,1,@CHARINDEX)
	SELECT @Part2 = SUBSTRING(@MSG,@CHARINDEX+2,LEN(@MSG))
	SELECT @Part1 Part1
	SELECT @Part2 Part2
END
ELSE 
BEGIN
	SET @Part1 = @MSG
	SET @Part2 = '0'
	SELECT @Part1 Part1
	SELECT @Part2 Part2
END
