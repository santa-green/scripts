--Скрипт для изменения активности акции @DiscCode для преприятий @CompIDs moa0
DECLARE @DiscCode INT = 255
		,@RollbackTran INT = 1 --если @RollbackTran = 1, то изменения откатятся
							   --если @RollbackTran = 0, то изменения вступят в силу
		,@CompIDs VARCHAR(MAX) = '1020,1101,1122,1139,1183,1601,1687,1935,1956,2048,2117,2169,2177,2178,2367,2495,2706,2737,2888,2907,3001,3038,3049,3054,3068,3089,3104,3157,3167,3234,3241,3314,3319,3402,3461,3466,3567,3575,3666,3715,3880,3897,3904,3985,4172,4221,4274,4339,4375,4401,4455,4495,4516,4615,4627,4661,4662,4685,4738,4833,4996,6235,6241,6529,6698,6750,6994,9274,9376,9498,9639,14009,14018,14022,14080,14084,14106,14136,14183,14251,14276,14355,14406,14566,14588,14626,14629,14673,14706,16004,16208,16330,16412,16694,16801,16813,16919,16991,23594,29012,29014,29124,29186,29192,29201,29208,29227,29242,29288,29302,29361,29363,29441,29710,29740,29783,29850,29942,40432,40578,40615,40672,40699,40770,40810,40936,40940,43330,43383,43679,43718,43835,43852,43999,44326,44510,44610,44681,44759,44928,49011,49047,49057,49077,49108,49126,49198,49243,49268,49310,49314,49323,49338,49344,49350,49362,49365,49396,49432,49449,49485,49487,49502,49511,49546,49556,49577,49593,49597,49598,49613,49620,49646,49654,49706,49745,49746,49747,49751,49754,49755,49760,49762,49767,49778,49791,49798,49803,49804,49815,49835,49836,49847,49848,49861,49862,49866,49878,49883,49892,49915,49918,49928,49932,49941,49942,49944,49948,49957,49962,49963,49965,49980,49983,49986,49997,49999,54011,54023,54157,54186,54337,54354,54454,54481,54641,54642,54748,54807,54819,54823,54867,54876,54970,54977,58052,58145,58162,58164,58174,58226,58236,58251,58264,58274,58290,58326,58327,58381,58384,58446,58451,58459,58471,58473,58477,58481,58486,58502,58512,58520,58522,58543,58547,58570,58573,58590,58616,58617,58633,58638,58643,58648,58649,58652,58655,58659,58675,58679,58683,58688,58689,58690,58691,58692,58697,58710,58711,58722,58723,58726,58759,58770,58773,58778,58795,58801,58815,58834,58835,58838,58848,58851,58856,58863,58871,59179,59224,59645,59688,59760,59761,59885,59888,59926,59962,61022,61039,61051,61073,61079,61122,61185,61190,61431,61497,61522,61540,61548,61567,61568,61583,61607,61617,61652,61660,61674,61686,61728,61752,61756,61760,61768,61774,61791,61792,61801,61811,61815,61830,61832,61865,61876,61877,61883,61885,61893,61900,61901,61916,61920,61926,61927,61941,62056,62071,62082,62089,62125,62176,62220,62353,62459,62503,62570,62650,62653,62674,62678,62759,62809,62846,64017,64058,65019,65022,65057,65109,65143,65146,65150,65202,65246,65270,65271,65293,65333,65342,65399,65452,65535,65541,65547,65584,65631,65655,65669,65682,65686,65720,65743,65771,65806,65821,65824,65830,65840,65939,65954,66005,66009,66017,66022,66024,66075,66079,66085,66089,66100,66123,66138,66150,66204,66246,66287,66311,66354,66358,66363,66375,66398,66399,66422,66431,66439,66442,66446,66453,66454,66539,69024,70004,70007,70015,70020,70022,70023,70025,70027,70029,70031,70033,70037,70039,70052,70060,70062,70063,70066,70067,70071,70073,70076,70082,70084,70087,70088,70099,70135,70138,70141,70142,70144,70151,70152,70161,70175,70178,70183,70184,70199,70204,70212,70218,70227,70228,70254,70279,70289,70291,70311,70325,70327,70332,70356,70358,70364,70367,70371,70372,70413,70451,70457,70465,70539,70569,70574,70611,70612,70618,70619,70620,70621,70624,70626,70627,70634,70641,70643,70645,70650,70653,70658,70676,70695,70706,70714,70738,70780,70786,70845,70881,71386'

BEGIN TRAN;

UPDATE at_r_DiscComps
SET Active = 0
WHERE DiscCode = @DiscCode 
	  AND CompID IN (SELECT AValue FROM zf_FilterToTable(@CompIDs))

SELECT * FROM at_r_DiscComps 
WHERE DiscCode = @DiscCode 
  AND CompID IN (SELECT AValue FROM zf_FilterToTable(@CompIDs))
  AND Active = 0
  
IF @RollbackTran = 1
ROLLBACK TRAN;
ELSE
COMMIT TRAN;