ALTER PROCEDURE [dbo].[t_SaleMenuCats](@AppCode int, @CRID int)/* Формирует список категорий товаров для приложений GMS Fast Food, GMS Ресторан */ASBEGIN  DECLARE @Delim varchar(250)  SELECT @Delim = dbo.zf_Var('z_FilterListSeparator')  /* Изменение логики выбора категорий для фильтра с "Общие настройки" на "Справочник складов: Фильтры" (Интерфейс) */  SELECT pc.PCatID, pc.PCatName, pc.Notes  FROM r_ProdC pc WITH(NOLOCK)  INNER JOIN r_Crs c WITH(NOLOCK) ON c.CRID = @CRID  INNER JOIN ir_StockFilters sf WITH(NOLOCK) ON sf.StockID = c.StockID AND sf.FilterType = 0  WHERE dbo.zf_MatchFilterInt(PCatID, sf.PCatFilter, @Delim) = 1 UNION    SELECT m.ProdID, p.ProdName, '' Notes  FROM it_ComplexMenu m  INNER JOIN r_ProdMP mp WITH(NOLOCK) ON m.ProdID = mp.ProdID AND m.PLID = mp.PLID  INNER JOIN r_Prods p WITH(NOLOCK) ON p.ProdID = m.ProdID  INNER JOIN r_Crs cr WITH(NOLOCK) ON cr.CRID = @CRID  INNER JOIN r_Stocks s WITH(NOLOCK) ON s.StockID = cr.StockID AND s.PLID = m.PLID  INNER JOIN ir_StockFilters sf WITH(NOLOCK) ON sf.StockID = cr.StockID AND sf.FilterType = 0  WHERE dbo.zf_MatchFilterInt(m.ProdID, sf.PCatFilter, @Delim) = 1    GROUP BY m.ProdID, p.ProdName    ORDER BY pc.PCatNameEND