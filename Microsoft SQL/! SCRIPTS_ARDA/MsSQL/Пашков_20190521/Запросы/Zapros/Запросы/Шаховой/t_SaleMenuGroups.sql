create PROCEDURE [dbo].[t_SaleMenuGroups](@AppCode int, @CRID int, @PCatID int)/* Формирует список групп товаров для приложения GMS Ресторан */ASBEGIN  DECLARE @Delim varchar(250)  DECLARE @GroupFilter varchar(250)  DECLARE @PLID int  DECLARE @UseStockPL bit  SELECT @Delim = dbo.zf_Var('z_FilterListSeparator')  SELECT @GroupFilter = dbo.zf_Var('Rest_GroupFilter')  SELECT @PLID = s.PLID, @UseStockPL = cr.UseStockPL FROM r_CRs cr INNER JOIN r_Stocks s ON cr.StockID = s.StockID AND cr.CRID = @CRID  SELECT g.PGrID, g.PGrName, g.Notes  FROM r_Prods p WITH(NOLOCK)    INNER JOIN r_ProdG g WITH(NOLOCK) ON p.PgrID = g.PgrID    INNER JOIN r_ProdMP mp WITH(NOLOCK) ON p.ProdID = mp.ProdID     INNER JOIN r_ProdMQ mq WITH(NOLOCK) ON p.ProdID = mq.ProdID	INNER JOIN r_CRs c WITH(NOLOCK) ON c.CRID = @CRID	INNER JOIN ir_StockFilters sf WITH(NOLOCK) ON sf.StockID = c.StockID AND sf.FilterType = 0  WHERE p.PCatID = @PCatID AND dbo.zf_MatchFilterInt(p.PGrID, sf.PGrFilter , @Delim) = 1 AND mp.PriceMC > 0 AND    ((@UseStockPL = 1 AND mp.PLID = @PLID) OR (@UseStockPL = 0 AND mp.PLID = mq.PLID))  GROUP BY g.PGrID, g.PGrName, g.NotesUNION  SELECT m.SrcPosID AS PGrID, CAST(m.SrcPosID AS Varchar)+'. '+m.Notes AS PGrName, '' Notes  FROM it_ComplexMenu m  INNER JOIN r_Prods p WITH(NOLOCK) ON p.ProdID = m.ProdID  INNER JOIN r_ProdMP mp WITH(NOLOCK) ON p.ProdID = mp.ProdID   INNER JOIN r_ProdMQ mq WITH(NOLOCK) ON p.ProdID = mq.ProdID  INNER JOIN r_CRs cr WITH(NOLOCK) ON cr.CRID = @CRID  INNER JOIN ir_StockFilters sf WITH(NOLOCK) ON sf.StockID = cr.StockID AND sf.FilterType = 0  WHERE m.ProdID = @PCatID AND dbo.zf_MatchFilterInt(p.PGrID, sf.PGrFilter , @Delim) = 1 AND mp.PriceMC > 0 AND    ((@UseStockPL = 1 AND mp.PLID = @PLID) OR (@UseStockPL = 0 AND mp.PLID = mq.PLID))  GROUP BY m.SrcPosID, m.Notes ORDER BY g.PGrNameEND