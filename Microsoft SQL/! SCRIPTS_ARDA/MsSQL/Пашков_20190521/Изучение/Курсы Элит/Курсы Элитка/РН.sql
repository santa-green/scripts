--WARNING! ERRORS ENCOUNTERED DURING SQL PARSING!
SELECT d.*
FROM t_Inv i
JOIN t_InvD d ON i.ChID = d.ChID
WHERE DocID IN (986126, 986191, 986275, 986278, 985505, 986277, 986277, 986306, 986374, 986407, 986407, 986408, 986438, 986401, 986412, 986412, 986412, 986582, 986694, 986768, 986772, 986772, 986773, 986785, 986785, 986910, 986953, 986371, 986371, 986371, 986371, 986373, 986375, 986769, 986769, 986779, 987085, 987085, 987085, 987095, 987187, 987406, 987488, 987488, 987532, 987559, 987559, 986969, 986969, 986608, 986608, 986608, 986608, 986771, 987335, 987467, 987467, 987491, 987602, 987702, 987796, 987842, 988035, 988035, 988035, 987572, 987572, 987994, 987994, 988047, 988171, 988172, 988336, 988535, 988571, 988136, 988136, 988164, 988164, 988164, 988164, 988169, 988169, 988170, 988166, 988168, 988168, 988235, 988597, 988602, 988623, 988642, 988642, 988674, 988678, 988678, 988106, 988167, 988428, 988580, 988580, 988121, 988121, 988165, 988182, 988182, 988237, 988368, 988590, 988590, 988591, 988596, 988675, 988675, 988676, 988584, 988584, 988584, 988584, 988752, 988777, 988777, 988815, 988815, 988579, 988679, 988776, 988776, 988776, 988776, 988827, 988827, 988876, 988888, 988888, 988888, 988888, 988888, 988677)


Create table #t (DocID int,ProdID int, PriceCC_WT  numeric(21,9))

Drop Table #t



Select *
From #t
go


BEGIN TRAN
Select d.*
From t_InvD d join t_Inv i on d.Chid=i.Chid
Where i.DocID = 986126 and ProdID = 22073

UPDATE d
SET d.PriceCC_WT = 193.98,
d.PriceCC_NT = 193.98/1.2,
d.Tax = ((193.98/1.2)*0.2),
d.PurPriceCC_wt = 193.98,
d.SumCC_nt = ((193.98/1.2)*d.Qty),
d.TaxSum = (((193.98/1.2)*0.2)*d.Qty),
d.Sumcc_wt= 193.98 *d.Qty
From t_InvD d join t_Inv i on d.Chid=i.Chid
Where i.DocID = 986126 and ProdID = 22073

Select d.*
From t_InvD d join t_Inv i on d.Chid=i.Chid
Where i.DocID = 986126 and ProdID = 22073
ROLLBACK TRAN



Select d.*
From t_InvD d join t_Inv i on d.Chid=i.Chid
Where i.DocID = 986126 and ProdID = 22073

a_tInvD_CheckFieldvalues_IU

go


Begin Tran
--Переменные
DECLARE @DocID int
DECLARE @ProdID int,
        @PriceCC_WT numeric(21,9)
SELECT d.*
FROM t_Inv i
JOIN t_InvD d ON i.ChID = d.ChID
WHERE DocID IN (986126, 986191, 986275, 986278, 985505, 986277, 986277, 986306, 986374, 986407, 986407, 986408, 986438, 986401, 986412, 986412, 986412, 986582, 986694, 986768, 986772, 986772, 986773, 986785, 986785, 986910, 986953, 986371, 986371, 986371, 986371, 986373, 986375, 986769, 986769, 986779, 987085, 987085, 987085, 987095, 987187, 987406, 987488, 987488, 987532, 987559, 987559, 986969, 986969, 986608, 986608, 986608, 986608, 986771, 987335, 987467, 987467, 987491, 987602, 987702, 987796, 987842, 988035, 988035, 988035, 987572, 987572, 987994, 987994, 988047, 988171, 988172, 988336, 988535, 988571, 988136, 988136, 988164, 988164, 988164, 988164, 988169, 988169, 988170, 988166, 988168, 988168, 988235, 988597, 988602, 988623, 988642, 988642, 988674, 988678, 988678, 988106, 988167, 988428, 988580, 988580, 988121, 988121, 988165, 988182, 988182, 988237, 988368, 988590, 988590, 988591, 988596, 988675, 988675, 988676, 988584, 988584, 988584, 988584, 988752, 988777, 988777, 988815, 988815, 988579, 988679, 988776, 988776, 988776, 988776, 988827, 988827, 988876, 988888, 988888, 988888, 988888, 988888, 988677)

DECLARE c CURSOR FOR SELECT DocID,ProdID,PriceCC_WT FROM #t; -- Таблица с которой вытягиваем
OPEN  c;

FETCH NEXT FROM c INTO @DocID,@ProdID,@PriceCC_WT;

WHILE @@fetch_status = 0
BEGIN

UPDATE d
SET d.PriceCC_WT = @PriceCC_WT,
d.PriceCC_NT = @PriceCC_WT/1.2,
d.Tax = ((@PriceCC_WT/1.2)*0.2),
d.PurPriceCC_wt = @PriceCC_WT,
d.SumCC_nt = ((@PriceCC_WT/1.2)*d.Qty),
d.TaxSum = (((@PriceCC_WT/1.2)*0.2)*d.Qty),
d.Sumcc_wt= @PriceCC_WT *d.Qty
From t_InvD d join t_Inv i on d.Chid=i.Chid
Where i.DocID = @DocID and ProdID = @ProdID


FETCH NEXT FROM c INTO @DocID,@ProdID,@PriceCC_WT;
END
CLOSE c
DEALLOCATE c

SELECT d.*
FROM t_Inv i
JOIN t_InvD d ON i.ChID = d.ChID
WHERE DocID IN (986126, 986191, 986275, 986278, 985505, 986277, 986277, 986306, 986374, 986407, 986407, 986408, 986438, 986401, 986412, 986412, 986412, 986582, 986694, 986768, 986772, 986772, 986773, 986785, 986785, 986910, 986953, 986371, 986371, 986371, 986371, 986373, 986375, 986769, 986769, 986779, 987085, 987085, 987085, 987095, 987187, 987406, 987488, 987488, 987532, 987559, 987559, 986969, 986969, 986608, 986608, 986608, 986608, 986771, 987335, 987467, 987467, 987491, 987602, 987702, 987796, 987842, 988035, 988035, 988035, 987572, 987572, 987994, 987994, 988047, 988171, 988172, 988336, 988535, 988571, 988136, 988136, 988164, 988164, 988164, 988164, 988169, 988169, 988170, 988166, 988168, 988168, 988235, 988597, 988602, 988623, 988642, 988642, 988674, 988678, 988678, 988106, 988167, 988428, 988580, 988580, 988121, 988121, 988165, 988182, 988182, 988237, 988368, 988590, 988590, 988591, 988596, 988675, 988675, 988676, 988584, 988584, 988584, 988584, 988752, 988777, 988777, 988815, 988815, 988579, 988679, 988776, 988776, 988776, 988776, 988827, 988827, 988876, 988888, 988888, 988888, 988888, 988888, 988677)


Rollback Tran

Select *
From t_Inv
Where ChID = 101423992[ElitStock]


Select *
From at_r_OurOfficials

BEGIN TRAN
UPDATE dbo.at_r_OurOfficials
SET CompGrID1 = 0
ROLLBACK TRAN


Begin Tran
Delete From dbo.at_r_OurOfficials
where 

Rollback Tran

Select *
from r_CompGrs1

Select *
from r_CompsADD

BEGIN TRAN

UPDATE r_CompsADD
SET CompGrID1 = 0

ROLLBACK TRAN


Select *
From r_OursCC


BEGIN TRAN

UPDATE r_OursCC
SET CompGrID1 = 0

ROLLBACK TRAN


Select *
from r_CompGrs1


BEGIN TRAN
Delete from r_CompGrs1
Where CompGrID1>0

ROLLBACK TRAN

