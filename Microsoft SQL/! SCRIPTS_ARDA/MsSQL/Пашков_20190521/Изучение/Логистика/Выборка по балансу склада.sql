--SELECT ChID,ProdID,ProdName,UM,Country,Notes,PCatID,PGrID,Article1,Article2,Article3,Weight,Age,PriceWithTax,Note1,Note2,Note3,MinPriceMC,MaxPriceMC,MinRem,CstDty,CstPrc,CstExc,StdExtraR,StdExtraE,MaxExtra,MinExtra,UseAlts,UseCrts,PGrID1,PGrID2,PGrID3,PGrAID,PBGrID,LExpSet,EExpSet,InRems,IsDecQty,File1,File2,File3,AutoSet,Extra1,Extra2,Extra3,Extra4,Extra5,Norma1,Norma2,Norma3,Norma4,Norma5,RecMinPriceCC,RecMaxPriceCC,RecStdPriceCC,RecRemQty,InStopList,PrepareTime,AmortID,WeightGr,WeightGrWP,PGrID4,PGrID5,DistrID,ImpID,ScaleGrID,ScaleStandard,ScaleConditions,ScaleComponents,ExcCostCC,CstDtyNotes,CstExcNotes,BoxVolume,SalesChannelID,IndRetPriceCC,IndWSPriceCC,SupID,TaxFreeReason,CstProdCode,TaxTypeID
--FROM r_Prods
SELECT ProdID,ProdName,UM,Country,Notes,PCatID,PGrID,Article1,Article2,Article3,Weight,Age,PriceWithTax,Note1,Note2,Note3,MinPriceMC,MaxPriceMC,MinRem,CstDty,CstPrc,CstExc,StdExtraR,StdExtraE,MaxExtra,MinExtra,UseAlts,UseCrts,PGrID1,PGrID2,PGrID3,PGrAID,PBGrID,LExpSet,EExpSet,InRems,IsDecQty,File1,File2,File3,AutoSet,Extra1,Extra2,Extra3,Extra4,Extra5,Norma1,Norma2,Norma3,Norma4,Norma5,RecMinPriceCC,RecMaxPriceCC,RecStdPriceCC,RecRemQty,InStopList,PrepareTime,AmortID,WeightGr,WeightGrWP,PGrID4,PGrID5,DistrID,ImpID,ScaleGrID,ScaleStandard,ScaleConditions,ScaleComponents,ExcCostCC,CstDtyNotes,CstExcNotes,BoxVolume,SalesChannelID,IndRetPriceCC,IndWSPriceCC,SupID,TaxFreeReason,CstProdCode,TaxTypeID
FROM r_Prods



--текущие остатки по центральному (220,218) складу с которого отгружать
SELECT gr.ProdID,  gr.SumQty , p.PCatID, r_ProdC.PCatName, p.ProdName, p.PGrID1, r_ProdG1.PGrName1  FROM (
	SELECT ProdID,  SUM(Qty - AccQty) SumQty FROM t_rem m WITH(NOLOCK)
	WHERE  StockID in (220,218)
	GROUP BY ProdID) gr 
JOIN r_Prods p WITH(NOLOCK) ON p.ProdID = gr.ProdID
JOIN r_ProdG1  WITH(NOLOCK) ON r_ProdG1.PGrID1 = p.PGrID1
JOIN r_ProdC  WITH(NOLOCK) ON r_ProdC.PCatID = p.PCatID
where p.PCatID between 1 and 100 and gr.SumQty > 0
ORDER BY 1



--Возврат товара от получателя t_Ret
SELECT d.ProdID, SUM(d.Qty) SumQty FROM t_Ret m WITH(NOLOCK)
JOIN t_RetD d WITH(NOLOCK) ON d.ChID = m.ChID
WHERE m.DocDate  BETWEEN '20171028' AND '20171228' 
and m.StockID = 4
GROUP BY d.ProdID
ORDER BY 1

--Расходная накладная t_Inv
SELECT d.ProdID, SUM(d.Qty) SumQty FROM t_Inv m WITH(NOLOCK)
JOIN t_InvD d WITH(NOLOCK) ON d.ChID = m.ChID
WHERE m.DocDate  BETWEEN '20171028' AND '20171228' 
and m.StockID = 4
GROUP BY d.ProdID
ORDER BY 1


--ВР - Расходный документ t_Exp
SELECT d.ProdID, SUM(d.Qty) SumQty FROM t_Exp m WITH(NOLOCK)
JOIN t_ExpD d WITH(NOLOCK) ON d.ChID = m.ChID
WHERE m.DocDate  BETWEEN '20171028' AND '20171228' 
and m.StockID = 4
GROUP BY d.ProdID
ORDER BY 1

--ВР в ЦП - Расходный документ в ценах прихода t_Epp
SELECT d.ProdID, SUM(d.Qty) SumQty FROM t_Epp m WITH(NOLOCK)
JOIN t_EppD d WITH(NOLOCK) ON d.ChID = m.ChID
WHERE m.DocDate  BETWEEN '20171028' AND '20171228' 
and m.StockID = 4
GROUP BY d.ProdID
ORDER BY 1


--текущие остатки по складу на который отгружать
SELECT gr.ProdID, gr.StockID, gr.SumQty , p.PCatID FROM (
	SELECT ProdID, StockID, SUM(Qty - AccQty) SumQty FROM t_rem m WITH(NOLOCK)
	WHERE  StockID = 4
	GROUP BY ProdID, StockID) gr 
JOIN r_Prods p WITH(NOLOCK)  ON p.ProdID = gr.ProdID
where p.PCatID between 1 and 100
ORDER BY 1

SELECT ProdID, StockID, SUM(Qty - AccQty) SumQty FROM t_rem m WITH(NOLOCK)
	WHERE  StockID = 4 and ProdID in (26136,32142,30728,26135,23774,23775,31879,31878,22071,24412,3127,32144,33106,33214,32388,28246,26137,28240,28978,33217,28245,32618,32363,32379,26134,33255,30767,29879,29054,32390,32389,30691,32381,3499,33098,33656,26213,33216,31960,28957,30370,30689,31574,32620,33296,31808,2746,2400,32020,30894,33040,33340,32893,29880,28958,30497,33460,33484,4885,27748,26138,32591,32587,33488,4353,33581,33039,32378,2457,2455,23403,4702,33291,33342,32592,33299,33295,33486,33213,29152,33716,32593,32699,32589,32590,26133,32998,32431,33623,21478,33025,32594,32597,32598,32573,2073,31777,27749,32051,29089,28261,4148,33341,31896,33576,30343,32600,32563,32084,27761,31441,33238,32382,32385,33298,32550,27747,31452,28592,30487,24549,28586,33115,32995,33572,31802,29808,32996,32436,33092,33620,33455,33610,33601,3840,25944,28253,31435,33352,33605,33297,33294,32994,33079,33077,33555,32520,32397,32599,32387,31950,33252,26166,31428,32052,32453,32616,31434,31443,33043,32293,33615,33618,33619,33577,25797,32603,31518,32405,32417,32552,32511,32509,4144,33244,33023,33024,32977,32017,4696,32910,33071,32818,32819,32588,32585,32586,33062,33445,4355,33128,29810,33430,33461,33481,33617,33483,33485,32446,32438,33096,33082,33667,32791,32784,32643,32645,31585,31602,31566,27391,25782,30371,28574,31748,30842,31837,32775,29134,32085,31445,31439,32290,33657,33607,33129,31882,31333,32150,32608,32578,31440,29091,31377,30637,25786,32899,33275,33276,33277,33278,32336,31977,22327,32391,32911,32913,32979,32948,33014,4125,32623,32627,33713,31328,24402,33452,33575,33400,33545,32456,32449,32878,33287,33658,33666,33035,33220,4887,4886,33284,22270,33449,2707,32894,28601,31430,30677,32274,32334,32251,32181,33573,33403,33426,33208,32163,31949,32043,4149,29328,31775,32403,32121,32465,33398,32434,32679,32545,31406,31567,31633,28241,28242,28243,28244,27395,27490,30650,31757,31788,31794,31795,31796,31798,30688,30690,26139,30766,24886,24887,24876,24877,24879,26698,26699,31446,31405,31586,31587,31595,31575,31576,31578,31579,31580,31581,31582,31583,31584,31603,31604,31616,31629,31791,24235,31864,31786,31787,31792,31793,31811,31813,31278,31280,26833,26683,31902,31903,31904,31571,31560,31564,31565,31432,31433,31429,26161,26168,31863,25799,31739,31833,31845,31846,31847,31848,31849,31444,31442,31457,31460,31401,31418,31462,31483,31484,31496,31497,31499,31501,31517,31379,31380,31381,31382,31383,31384,31397,31399,31410,31411,31412,31415,31409,31423,31424,31425,31427,30488,30489,30490,32030,32031,26152,31831,31860,31861,31862,30843,30846,30998,31000,31002,30875,30876,31783,31856,28585,28602,28603,28941,28942,28952,28953,31737,29329,29330,31820,26726,26734,27604,27607,27708,27753,27754,28378,28392,28393,28394,28354,28356,25787,25788,25791,25792,25793,25794,25783,25784,25781,28598,28599,29090,29077,29080,29081,29083,30402,30436,30437,30386,30474,30475,30481,30483,30484,29065,29066,30403,30425,30427,30429,30430,31749,30638,30641,30643,30648,32061,32062,32063,32064,32067,32069,32072,32073,32074,32076,32080,32081,32088,32089,32093,32098,32099,32101,32103,32104,32106,32107,31273,31274,30871,30872,31750,30888,30891,30935,30936,30937,31776,31276,30746,30745,30499,30554,30555,30628,31790,31838,31839,24664,26886,27408,27446,27460,27476,30440,30445,30457,30866,30920,30922,30884,30898,31090,31129,31130,31269,31271,31289,31290,31291,31293,31294,31300,31315,31351,31354,31355,31356,31357,31358,31363,31367,31368,31371,31372,31376,32776,32777,32778,32779,26687,24442,27735,27739,27744,28283,31554,31555,31601,30748,31771,27750,31760,31624,31625,31626,31765,31822,31823,31824,31825,31826,31827,31828,31829,32714,32715,32044,32045,32046,32048,30719,30724,31762,32602,31809,30791,30794,31520,31521,31522,28290,32546,1754,32624,32625,32626,32628,32630,32631,32632,32633,32634,32635,32636,32637,32544,4717,32595,4363,32717,32908,32909,33631,33632,33633,33634,33635,33636,33637,33638,33640,33641,33674,32605,32696,32621,32622,32681,32683,32684,32685,32686,32687,32688,32689,32690,32692,32693,32695,32361,32362,4540,4685,32886,32888,32700,32671,32672,32673,32674,32676,32677,32678,4200,32553,32554,32901,32902,32903,32904,32905,32906,33018,33058,33059,33072,33073,33074,33075,31929,31963,31964,32551,32401,32402,32406,32407,32408,32409,32410,32411,32412,32413,32414,33019,32657,32658,32659,31322,31323,31324,32666,32667,32668,32670,32481,32483,32484,32485,32486,32488,32489,32490,32491,32492,32493,32494,32496,32497,32498,32499,32500,32501,32502,32503,32504,32505,32506,32507,32508,4165,4167,32638,32992,32364,32614,32830,32831,32832,32833,32547,33245,33246,33247,33248,33249,4127,4129,4130,4131,4132,4133,4134,4136,4138,4139,4142,32513,32514,32515,32516,32517,32518,32521,32522,32523,32524,32525,32526,32527,32528,32529,32548,32549,33045,33046,33047,33048,33049,33050,33051,33052,33053,22379,32697,32698,32510,32617,32619,4126,33222,33223,33224,33225,33226,33227,33228,33229,32806,32807,32646,32647,32648,32649,32651,32653,32654,33054,33055,33056,33057,33015,33016,33211,4342,32656,33556,33557,33642,33643,33644,33645,33036,32949,32947,33009,33010,33011,33012,33013,32980,32981,32982,32983,32984,33021,33022,32957,32958,32959,32961,32962,32963,32965,32967,32968,32969,32970,32971,32972,32973,32974,32975,32976,32122,32238,32239,32240,32241,32242,32243,32244,32245,32246,32247,32248,32249,32250,32252,32254,32255,31918,31920,31921,32326,32327,32328,32329,32330,32332,32333,32032,32033,32034,32035,32037,32038,32039,32040,2159,32042,32086,32087,32342,33254,33756,31957,31958,31959,31909,31910,31937,32154,32155,32158,32159,32160,32319,32320,32322,32323,32082,32083,33239,32277,32278,32279,32281,32282,32283,32294,32295,32296,32298,32302,32304,32305,32306,32307,32308,32309,32310,32311,32312,32313,32314,32315,32335,32577,32565,32566,32567,32569,32570,32571,32812,32813,32815,32817,32823,32826,32827,32828,31933,32895,31998,32026,32556,32557,32560,32561,32562,32662,32256,32339,32340,32889,32890,32891,32892,32019,4695,1213,1214,33279,33280,32111,32113,32370,32373,32374,32375,32376,32377,33063,33064,33065,33271,33274,32900,32914,33060,33061,32579,32580,32581,32582,32584,31940,31941,31970,31971,32027,32028,33076,32896,32610,32151,32152,32153,21411,32162,31952,31954,31955,32316,32147,31944,31947,31948,3089,32053,32054,32056,32125,32126,32127,32129,32131,32132,32133,32134,32135,32136,32137,32139,32140,32141,32392,32393,32394,32395,32396,32386,32380,32143,32383,32384,32145,32146,32189,32190,32191,32192,32193,32194,32195,32196,32208,32211,32218,32228,32317,32318,32164,32165,32166,32168,32169,32170,32171,32173,21418,21419,32357,32359,32360,32606,32607,32000,32001,32002,32231,32232,32257,32259,2699,32180,32912,32291,31965,31966,31967,32349,32350,32351,32720,32324,32005,32006,32007,32013,32014,32015,32016,32343,32346,33066,33067,33068,33069,31772,31978,31984,31994,31996,31997,31880,32018,32185,32275,32284,32285,32286,32287,32289,32435,32432,32433,32426,32427,32430,33646,33647,33648,33649,33650,33651,33652,33653,33654,33655,33080,33558,33559,33560,33561,33562,32993,33230,33231,4697,33259,33260,33261,33262,33078,32441,32424,32834,32835,32836,32837,32838,32839,32840,32841,32842,32843,32844,32845,32846,32847,32848,33026,1396,33236,33237,32883,32884,32885,33027,33028,33029,33030,33031,33032,33033,33034,33212,33668,33669,4703,4708,4709,32781,32782,32783,33081,32644,32785,32786,32787,32789,32793,32794,32852,32639,32640,32641,32642,4943,4946,4947,4948,32444,1209,1210,1211,33256,33257,1376,4903,33091,33097,33099,1717,33093,33094,33095,33083,33084,33085,33086,33087,33088,33089,33090,32419,32420,32421,32422,32423,4698,32801,32802,32803,32804,32805,32850,32470,32471,32472,32476,32477,32478,32480,32881,32455,32458,33268,33293,32447,32879,32461,32464,32450,32451,32452,21404,21406,32853,32854,32855,32857,32861,32862,32863,32871,32872,32875,32876,33282,33288,33321,33322,33606,33721,33722,33726,33727,33737,33324,33422,33423,33424,33425,33326,2729,33281,33300,33301,33303,33130,33131,33132,33596,33323,33336,33337,33338,33339,33427,33428,33429,33285,33286,33609,33431,33432,33434,33435,33436,33437,33438,33439,33440,33441,33442,33603,33604,33616,33611,33612,33613,33614,33602,33345,33346,33347,33348,33349,33350,33351,33487,33489,33523,33524,33482,33456,33457,33458,33459,33463,33464,33314,33315,33316,33479,33480,33353,33290,22300,33454,33621,33622,33624,33402,33404,33405,33406,33407,33710,33711,33582,33583,33584,33585,33586,33587,33588,33589,33590,33574,33450,33451,33578,33579,33580,33453,33542,33543,33544,33446,33447,33448,33305,33306,33536,33537,33538,33539,33540,33541,33691,33718,33768,33309,33310,33311,33312,33443,33444,33327,33328,33329,33330,33331,33332,33333,33334,33546,33547,33548,33549,33550,33551,33552,33553,33554,33717,33723,33724,33850,2704,2745,29119,29120,29188,31887,31889,31890,31893,29153,31897,31898,32116,32117,32119,32120,2458,2456,32713,2708,29200,32718,32719,29121,29155,21515,31283,2142,21672,31298,31326,31329,31330,22022,22070,33714,33715,33719,27569,31339,29099,29100,29102,29106,29108,29109,29110,29111,29169,29170,29219,29221,29222,23138,23087,33705,33706,33707,33708,33709,22109,33736,2709,29333,2706,29837,29840,29355,22276,22072,22073,27572,33684,33685,33686,33687,33688,33689,33690,33692,33693,33694,4350,31334,30342,29809,4720,2747,23146,4135,4140,33070,27497,27529,23022,31774,4349,29913,29914,31814,31815,29915,29916,29917,29918,29919,29920,29921,29922,29923,29924,29925,29926,29927,29929,29930,31816,31818,20002,21417,4721,4289,2070,29885,29891,29815,29817,29819,29820,29872,29873,29874,29875,29876,29878,29881,29898,29899,29900,29901,29902,29903,29904,29905,29906,29907,29908,29909,29910,29911,29912,29726,32148,31801,31895,29151,23776,23531,23573,23576,23498,29714,29716,29715,31835,2524,2453,31779,30325,22444,29177,31780,31338,21457,32986,32987,32988,4312,29799,29800,29804,29805,29784,29785,31141,29671,29674,29712,31773,2710,2712,2713,2715,2716,2717,2718,2719,2720,2723,2725,2726,2727,2728,2730,2731,2732,2733,2734,2735,2736,2738,29735,29737,29738,29739,29742,29743,29745,29746,29747,30358,23238,29828,30303,30306,30309,30310)
	and ProdID = 26136
	GROUP BY ProdID, StockID

SELECT SUM(Qty - AccQty) SumQty FROM t_rem m WITH(NOLOCK)
	WHERE  StockID = 4 and ProdID in (26136,32142,30728,26135,23774,23775,31879,31878,22071,24412,3127,32144,33106,33214,32388,28246,26137,28240,28978,33217,28245,32618,32363,32379,26134,33255,30767,29879,29054,32390,32389,30691,32381,3499,33098,33656,26213,33216,31960,28957,30370,30689,31574,32620,33296,31808,2746,2400,32020,30894,33040,33340,32893,29880,28958,30497,33460,33484,4885,27748,26138,32591,32587,33488,4353,33581,33039,32378,2457,2455,23403,4702,33291,33342,32592,33299,33295,33486,33213,29152,33716,32593,32699,32589,32590,26133,32998,32431,33623,21478,33025,32594,32597,32598,32573,2073,31777,27749,32051,29089,28261,4148,33341,31896,33576,30343,32600,32563,32084,27761,31441,33238,32382,32385,33298,32550,27747,31452,28592,30487,24549,28586,33115,32995,33572,31802,29808,32996,32436,33092,33620,33455,33610,33601,3840,25944,28253,31435,33352,33605,33297,33294,32994,33079,33077,33555,32520,32397,32599,32387,31950,33252,26166,31428,32052,32453,32616,31434,31443,33043,32293,33615,33618,33619,33577,25797,32603,31518,32405,32417,32552,32511,32509,4144,33244,33023,33024,32977,32017,4696,32910,33071,32818,32819,32588,32585,32586,33062,33445,4355,33128,29810,33430,33461,33481,33617,33483,33485,32446,32438,33096,33082,33667,32791,32784,32643,32645,31585,31602,31566,27391,25782,30371,28574,31748,30842,31837,32775,29134,32085,31445,31439,32290,33657,33607,33129,31882,31333,32150,32608,32578,31440,29091,31377,30637,25786,32899,33275,33276,33277,33278,32336,31977,22327,32391,32911,32913,32979,32948,33014,4125,32623,32627,33713,31328,24402,33452,33575,33400,33545,32456,32449,32878,33287,33658,33666,33035,33220,4887,4886,33284,22270,33449,2707,32894,28601,31430,30677,32274,32334,32251,32181,33573,33403,33426,33208,32163,31949,32043,4149,29328,31775,32403,32121,32465,33398,32434,32679,32545,31406,31567,31633,28241,28242,28243,28244,27395,27490,30650,31757,31788,31794,31795,31796,31798,30688,30690,26139,30766,24886,24887,24876,24877,24879,26698,26699,31446,31405,31586,31587,31595,31575,31576,31578,31579,31580,31581,31582,31583,31584,31603,31604,31616,31629,31791,24235,31864,31786,31787,31792,31793,31811,31813,31278,31280,26833,26683,31902,31903,31904,31571,31560,31564,31565,31432,31433,31429,26161,26168,31863,25799,31739,31833,31845,31846,31847,31848,31849,31444,31442,31457,31460,31401,31418,31462,31483,31484,31496,31497,31499,31501,31517,31379,31380,31381,31382,31383,31384,31397,31399,31410,31411,31412,31415,31409,31423,31424,31425,31427,30488,30489,30490,32030,32031,26152,31831,31860,31861,31862,30843,30846,30998,31000,31002,30875,30876,31783,31856,28585,28602,28603,28941,28942,28952,28953,31737,29329,29330,31820,26726,26734,27604,27607,27708,27753,27754,28378,28392,28393,28394,28354,28356,25787,25788,25791,25792,25793,25794,25783,25784,25781,28598,28599,29090,29077,29080,29081,29083,30402,30436,30437,30386,30474,30475,30481,30483,30484,29065,29066,30403,30425,30427,30429,30430,31749,30638,30641,30643,30648,32061,32062,32063,32064,32067,32069,32072,32073,32074,32076,32080,32081,32088,32089,32093,32098,32099,32101,32103,32104,32106,32107,31273,31274,30871,30872,31750,30888,30891,30935,30936,30937,31776,31276,30746,30745,30499,30554,30555,30628,31790,31838,31839,24664,26886,27408,27446,27460,27476,30440,30445,30457,30866,30920,30922,30884,30898,31090,31129,31130,31269,31271,31289,31290,31291,31293,31294,31300,31315,31351,31354,31355,31356,31357,31358,31363,31367,31368,31371,31372,31376,32776,32777,32778,32779,26687,24442,27735,27739,27744,28283,31554,31555,31601,30748,31771,27750,31760,31624,31625,31626,31765,31822,31823,31824,31825,31826,31827,31828,31829,32714,32715,32044,32045,32046,32048,30719,30724,31762,32602,31809,30791,30794,31520,31521,31522,28290,32546,1754,32624,32625,32626,32628,32630,32631,32632,32633,32634,32635,32636,32637,32544,4717,32595,4363,32717,32908,32909,33631,33632,33633,33634,33635,33636,33637,33638,33640,33641,33674,32605,32696,32621,32622,32681,32683,32684,32685,32686,32687,32688,32689,32690,32692,32693,32695,32361,32362,4540,4685,32886,32888,32700,32671,32672,32673,32674,32676,32677,32678,4200,32553,32554,32901,32902,32903,32904,32905,32906,33018,33058,33059,33072,33073,33074,33075,31929,31963,31964,32551,32401,32402,32406,32407,32408,32409,32410,32411,32412,32413,32414,33019,32657,32658,32659,31322,31323,31324,32666,32667,32668,32670,32481,32483,32484,32485,32486,32488,32489,32490,32491,32492,32493,32494,32496,32497,32498,32499,32500,32501,32502,32503,32504,32505,32506,32507,32508,4165,4167,32638,32992,32364,32614,32830,32831,32832,32833,32547,33245,33246,33247,33248,33249,4127,4129,4130,4131,4132,4133,4134,4136,4138,4139,4142,32513,32514,32515,32516,32517,32518,32521,32522,32523,32524,32525,32526,32527,32528,32529,32548,32549,33045,33046,33047,33048,33049,33050,33051,33052,33053,22379,32697,32698,32510,32617,32619,4126,33222,33223,33224,33225,33226,33227,33228,33229,32806,32807,32646,32647,32648,32649,32651,32653,32654,33054,33055,33056,33057,33015,33016,33211,4342,32656,33556,33557,33642,33643,33644,33645,33036,32949,32947,33009,33010,33011,33012,33013,32980,32981,32982,32983,32984,33021,33022,32957,32958,32959,32961,32962,32963,32965,32967,32968,32969,32970,32971,32972,32973,32974,32975,32976,32122,32238,32239,32240,32241,32242,32243,32244,32245,32246,32247,32248,32249,32250,32252,32254,32255,31918,31920,31921,32326,32327,32328,32329,32330,32332,32333,32032,32033,32034,32035,32037,32038,32039,32040,2159,32042,32086,32087,32342,33254,33756,31957,31958,31959,31909,31910,31937,32154,32155,32158,32159,32160,32319,32320,32322,32323,32082,32083,33239,32277,32278,32279,32281,32282,32283,32294,32295,32296,32298,32302,32304,32305,32306,32307,32308,32309,32310,32311,32312,32313,32314,32315,32335,32577,32565,32566,32567,32569,32570,32571,32812,32813,32815,32817,32823,32826,32827,32828,31933,32895,31998,32026,32556,32557,32560,32561,32562,32662,32256,32339,32340,32889,32890,32891,32892,32019,4695,1213,1214,33279,33280,32111,32113,32370,32373,32374,32375,32376,32377,33063,33064,33065,33271,33274,32900,32914,33060,33061,32579,32580,32581,32582,32584,31940,31941,31970,31971,32027,32028,33076,32896,32610,32151,32152,32153,21411,32162,31952,31954,31955,32316,32147,31944,31947,31948,3089,32053,32054,32056,32125,32126,32127,32129,32131,32132,32133,32134,32135,32136,32137,32139,32140,32141,32392,32393,32394,32395,32396,32386,32380,32143,32383,32384,32145,32146,32189,32190,32191,32192,32193,32194,32195,32196,32208,32211,32218,32228,32317,32318,32164,32165,32166,32168,32169,32170,32171,32173,21418,21419,32357,32359,32360,32606,32607,32000,32001,32002,32231,32232,32257,32259,2699,32180,32912,32291,31965,31966,31967,32349,32350,32351,32720,32324,32005,32006,32007,32013,32014,32015,32016,32343,32346,33066,33067,33068,33069,31772,31978,31984,31994,31996,31997,31880,32018,32185,32275,32284,32285,32286,32287,32289,32435,32432,32433,32426,32427,32430,33646,33647,33648,33649,33650,33651,33652,33653,33654,33655,33080,33558,33559,33560,33561,33562,32993,33230,33231,4697,33259,33260,33261,33262,33078,32441,32424,32834,32835,32836,32837,32838,32839,32840,32841,32842,32843,32844,32845,32846,32847,32848,33026,1396,33236,33237,32883,32884,32885,33027,33028,33029,33030,33031,33032,33033,33034,33212,33668,33669,4703,4708,4709,32781,32782,32783,33081,32644,32785,32786,32787,32789,32793,32794,32852,32639,32640,32641,32642,4943,4946,4947,4948,32444,1209,1210,1211,33256,33257,1376,4903,33091,33097,33099,1717,33093,33094,33095,33083,33084,33085,33086,33087,33088,33089,33090,32419,32420,32421,32422,32423,4698,32801,32802,32803,32804,32805,32850,32470,32471,32472,32476,32477,32478,32480,32881,32455,32458,33268,33293,32447,32879,32461,32464,32450,32451,32452,21404,21406,32853,32854,32855,32857,32861,32862,32863,32871,32872,32875,32876,33282,33288,33321,33322,33606,33721,33722,33726,33727,33737,33324,33422,33423,33424,33425,33326,2729,33281,33300,33301,33303,33130,33131,33132,33596,33323,33336,33337,33338,33339,33427,33428,33429,33285,33286,33609,33431,33432,33434,33435,33436,33437,33438,33439,33440,33441,33442,33603,33604,33616,33611,33612,33613,33614,33602,33345,33346,33347,33348,33349,33350,33351,33487,33489,33523,33524,33482,33456,33457,33458,33459,33463,33464,33314,33315,33316,33479,33480,33353,33290,22300,33454,33621,33622,33624,33402,33404,33405,33406,33407,33710,33711,33582,33583,33584,33585,33586,33587,33588,33589,33590,33574,33450,33451,33578,33579,33580,33453,33542,33543,33544,33446,33447,33448,33305,33306,33536,33537,33538,33539,33540,33541,33691,33718,33768,33309,33310,33311,33312,33443,33444,33327,33328,33329,33330,33331,33332,33333,33334,33546,33547,33548,33549,33550,33551,33552,33553,33554,33717,33723,33724,33850,2704,2745,29119,29120,29188,31887,31889,31890,31893,29153,31897,31898,32116,32117,32119,32120,2458,2456,32713,2708,29200,32718,32719,29121,29155,21515,31283,2142,21672,31298,31326,31329,31330,22022,22070,33714,33715,33719,27569,31339,29099,29100,29102,29106,29108,29109,29110,29111,29169,29170,29219,29221,29222,23138,23087,33705,33706,33707,33708,33709,22109,33736,2709,29333,2706,29837,29840,29355,22276,22072,22073,27572,33684,33685,33686,33687,33688,33689,33690,33692,33693,33694,4350,31334,30342,29809,4720,2747,23146,4135,4140,33070,27497,27529,23022,31774,4349,29913,29914,31814,31815,29915,29916,29917,29918,29919,29920,29921,29922,29923,29924,29925,29926,29927,29929,29930,31816,31818,20002,21417,4721,4289,2070,29885,29891,29815,29817,29819,29820,29872,29873,29874,29875,29876,29878,29881,29898,29899,29900,29901,29902,29903,29904,29905,29906,29907,29908,29909,29910,29911,29912,29726,32148,31801,31895,29151,23776,23531,23573,23576,23498,29714,29716,29715,31835,2524,2453,31779,30325,22444,29177,31780,31338,21457,32986,32987,32988,4312,29799,29800,29804,29805,29784,29785,31141,29671,29674,29712,31773,2710,2712,2713,2715,2716,2717,2718,2719,2720,2723,2725,2726,2727,2728,2730,2731,2732,2733,2734,2735,2736,2738,29735,29737,29738,29739,29742,29743,29745,29746,29747,30358,23238,29828,30303,30306,30309,30310
)
SELECT SUM(Qty ) SumQty FROM t_rem m WITH(NOLOCK)
	WHERE  StockID = 4 and ProdID in (26136,32142,30728,26135,23774,23775,31879,31878,22071,24412,3127,32144,33106,33214,32388,28246,26137,28240,28978,33217,28245,32618,32363,32379,26134,33255,30767,29879,29054,32390,32389,30691,32381,3499,33098,33656,26213,33216,31960,28957,30370,30689,31574,32620,33296,31808,2746,2400,32020,30894,33040,33340,32893,29880,28958,30497,33460,33484,4885,27748,26138,32591,32587,33488,4353,33581,33039,32378,2457,2455,23403,4702,33291,33342,32592,33299,33295,33486,33213,29152,33716,32593,32699,32589,32590,26133,32998,32431,33623,21478,33025,32594,32597,32598,32573,2073,31777,27749,32051,29089,28261,4148,33341,31896,33576,30343,32600,32563,32084,27761,31441,33238,32382,32385,33298,32550,27747,31452,28592,30487,24549,28586,33115,32995,33572,31802,29808,32996,32436,33092,33620,33455,33610,33601,3840,25944,28253,31435,33352,33605,33297,33294,32994,33079,33077,33555,32520,32397,32599,32387,31950,33252,26166,31428,32052,32453,32616,31434,31443,33043,32293,33615,33618,33619,33577,25797,32603,31518,32405,32417,32552,32511,32509,4144,33244,33023,33024,32977,32017,4696,32910,33071,32818,32819,32588,32585,32586,33062,33445,4355,33128,29810,33430,33461,33481,33617,33483,33485,32446,32438,33096,33082,33667,32791,32784,32643,32645,31585,31602,31566,27391,25782,30371,28574,31748,30842,31837,32775,29134,32085,31445,31439,32290,33657,33607,33129,31882,31333,32150,32608,32578,31440,29091,31377,30637,25786,32899,33275,33276,33277,33278,32336,31977,22327,32391,32911,32913,32979,32948,33014,4125,32623,32627,33713,31328,24402,33452,33575,33400,33545,32456,32449,32878,33287,33658,33666,33035,33220,4887,4886,33284,22270,33449,2707,32894,28601,31430,30677,32274,32334,32251,32181,33573,33403,33426,33208,32163,31949,32043,4149,29328,31775,32403,32121,32465,33398,32434,32679,32545,31406,31567,31633,28241,28242,28243,28244,27395,27490,30650,31757,31788,31794,31795,31796,31798,30688,30690,26139,30766,24886,24887,24876,24877,24879,26698,26699,31446,31405,31586,31587,31595,31575,31576,31578,31579,31580,31581,31582,31583,31584,31603,31604,31616,31629,31791,24235,31864,31786,31787,31792,31793,31811,31813,31278,31280,26833,26683,31902,31903,31904,31571,31560,31564,31565,31432,31433,31429,26161,26168,31863,25799,31739,31833,31845,31846,31847,31848,31849,31444,31442,31457,31460,31401,31418,31462,31483,31484,31496,31497,31499,31501,31517,31379,31380,31381,31382,31383,31384,31397,31399,31410,31411,31412,31415,31409,31423,31424,31425,31427,30488,30489,30490,32030,32031,26152,31831,31860,31861,31862,30843,30846,30998,31000,31002,30875,30876,31783,31856,28585,28602,28603,28941,28942,28952,28953,31737,29329,29330,31820,26726,26734,27604,27607,27708,27753,27754,28378,28392,28393,28394,28354,28356,25787,25788,25791,25792,25793,25794,25783,25784,25781,28598,28599,29090,29077,29080,29081,29083,30402,30436,30437,30386,30474,30475,30481,30483,30484,29065,29066,30403,30425,30427,30429,30430,31749,30638,30641,30643,30648,32061,32062,32063,32064,32067,32069,32072,32073,32074,32076,32080,32081,32088,32089,32093,32098,32099,32101,32103,32104,32106,32107,31273,31274,30871,30872,31750,30888,30891,30935,30936,30937,31776,31276,30746,30745,30499,30554,30555,30628,31790,31838,31839,24664,26886,27408,27446,27460,27476,30440,30445,30457,30866,30920,30922,30884,30898,31090,31129,31130,31269,31271,31289,31290,31291,31293,31294,31300,31315,31351,31354,31355,31356,31357,31358,31363,31367,31368,31371,31372,31376,32776,32777,32778,32779,26687,24442,27735,27739,27744,28283,31554,31555,31601,30748,31771,27750,31760,31624,31625,31626,31765,31822,31823,31824,31825,31826,31827,31828,31829,32714,32715,32044,32045,32046,32048,30719,30724,31762,32602,31809,30791,30794,31520,31521,31522,28290,32546,1754,32624,32625,32626,32628,32630,32631,32632,32633,32634,32635,32636,32637,32544,4717,32595,4363,32717,32908,32909,33631,33632,33633,33634,33635,33636,33637,33638,33640,33641,33674,32605,32696,32621,32622,32681,32683,32684,32685,32686,32687,32688,32689,32690,32692,32693,32695,32361,32362,4540,4685,32886,32888,32700,32671,32672,32673,32674,32676,32677,32678,4200,32553,32554,32901,32902,32903,32904,32905,32906,33018,33058,33059,33072,33073,33074,33075,31929,31963,31964,32551,32401,32402,32406,32407,32408,32409,32410,32411,32412,32413,32414,33019,32657,32658,32659,31322,31323,31324,32666,32667,32668,32670,32481,32483,32484,32485,32486,32488,32489,32490,32491,32492,32493,32494,32496,32497,32498,32499,32500,32501,32502,32503,32504,32505,32506,32507,32508,4165,4167,32638,32992,32364,32614,32830,32831,32832,32833,32547,33245,33246,33247,33248,33249,4127,4129,4130,4131,4132,4133,4134,4136,4138,4139,4142,32513,32514,32515,32516,32517,32518,32521,32522,32523,32524,32525,32526,32527,32528,32529,32548,32549,33045,33046,33047,33048,33049,33050,33051,33052,33053,22379,32697,32698,32510,32617,32619,4126,33222,33223,33224,33225,33226,33227,33228,33229,32806,32807,32646,32647,32648,32649,32651,32653,32654,33054,33055,33056,33057,33015,33016,33211,4342,32656,33556,33557,33642,33643,33644,33645,33036,32949,32947,33009,33010,33011,33012,33013,32980,32981,32982,32983,32984,33021,33022,32957,32958,32959,32961,32962,32963,32965,32967,32968,32969,32970,32971,32972,32973,32974,32975,32976,32122,32238,32239,32240,32241,32242,32243,32244,32245,32246,32247,32248,32249,32250,32252,32254,32255,31918,31920,31921,32326,32327,32328,32329,32330,32332,32333,32032,32033,32034,32035,32037,32038,32039,32040,2159,32042,32086,32087,32342,33254,33756,31957,31958,31959,31909,31910,31937,32154,32155,32158,32159,32160,32319,32320,32322,32323,32082,32083,33239,32277,32278,32279,32281,32282,32283,32294,32295,32296,32298,32302,32304,32305,32306,32307,32308,32309,32310,32311,32312,32313,32314,32315,32335,32577,32565,32566,32567,32569,32570,32571,32812,32813,32815,32817,32823,32826,32827,32828,31933,32895,31998,32026,32556,32557,32560,32561,32562,32662,32256,32339,32340,32889,32890,32891,32892,32019,4695,1213,1214,33279,33280,32111,32113,32370,32373,32374,32375,32376,32377,33063,33064,33065,33271,33274,32900,32914,33060,33061,32579,32580,32581,32582,32584,31940,31941,31970,31971,32027,32028,33076,32896,32610,32151,32152,32153,21411,32162,31952,31954,31955,32316,32147,31944,31947,31948,3089,32053,32054,32056,32125,32126,32127,32129,32131,32132,32133,32134,32135,32136,32137,32139,32140,32141,32392,32393,32394,32395,32396,32386,32380,32143,32383,32384,32145,32146,32189,32190,32191,32192,32193,32194,32195,32196,32208,32211,32218,32228,32317,32318,32164,32165,32166,32168,32169,32170,32171,32173,21418,21419,32357,32359,32360,32606,32607,32000,32001,32002,32231,32232,32257,32259,2699,32180,32912,32291,31965,31966,31967,32349,32350,32351,32720,32324,32005,32006,32007,32013,32014,32015,32016,32343,32346,33066,33067,33068,33069,31772,31978,31984,31994,31996,31997,31880,32018,32185,32275,32284,32285,32286,32287,32289,32435,32432,32433,32426,32427,32430,33646,33647,33648,33649,33650,33651,33652,33653,33654,33655,33080,33558,33559,33560,33561,33562,32993,33230,33231,4697,33259,33260,33261,33262,33078,32441,32424,32834,32835,32836,32837,32838,32839,32840,32841,32842,32843,32844,32845,32846,32847,32848,33026,1396,33236,33237,32883,32884,32885,33027,33028,33029,33030,33031,33032,33033,33034,33212,33668,33669,4703,4708,4709,32781,32782,32783,33081,32644,32785,32786,32787,32789,32793,32794,32852,32639,32640,32641,32642,4943,4946,4947,4948,32444,1209,1210,1211,33256,33257,1376,4903,33091,33097,33099,1717,33093,33094,33095,33083,33084,33085,33086,33087,33088,33089,33090,32419,32420,32421,32422,32423,4698,32801,32802,32803,32804,32805,32850,32470,32471,32472,32476,32477,32478,32480,32881,32455,32458,33268,33293,32447,32879,32461,32464,32450,32451,32452,21404,21406,32853,32854,32855,32857,32861,32862,32863,32871,32872,32875,32876,33282,33288,33321,33322,33606,33721,33722,33726,33727,33737,33324,33422,33423,33424,33425,33326,2729,33281,33300,33301,33303,33130,33131,33132,33596,33323,33336,33337,33338,33339,33427,33428,33429,33285,33286,33609,33431,33432,33434,33435,33436,33437,33438,33439,33440,33441,33442,33603,33604,33616,33611,33612,33613,33614,33602,33345,33346,33347,33348,33349,33350,33351,33487,33489,33523,33524,33482,33456,33457,33458,33459,33463,33464,33314,33315,33316,33479,33480,33353,33290,22300,33454,33621,33622,33624,33402,33404,33405,33406,33407,33710,33711,33582,33583,33584,33585,33586,33587,33588,33589,33590,33574,33450,33451,33578,33579,33580,33453,33542,33543,33544,33446,33447,33448,33305,33306,33536,33537,33538,33539,33540,33541,33691,33718,33768,33309,33310,33311,33312,33443,33444,33327,33328,33329,33330,33331,33332,33333,33334,33546,33547,33548,33549,33550,33551,33552,33553,33554,33717,33723,33724,33850,2704,2745,29119,29120,29188,31887,31889,31890,31893,29153,31897,31898,32116,32117,32119,32120,2458,2456,32713,2708,29200,32718,32719,29121,29155,21515,31283,2142,21672,31298,31326,31329,31330,22022,22070,33714,33715,33719,27569,31339,29099,29100,29102,29106,29108,29109,29110,29111,29169,29170,29219,29221,29222,23138,23087,33705,33706,33707,33708,33709,22109,33736,2709,29333,2706,29837,29840,29355,22276,22072,22073,27572,33684,33685,33686,33687,33688,33689,33690,33692,33693,33694,4350,31334,30342,29809,4720,2747,23146,4135,4140,33070,27497,27529,23022,31774,4349,29913,29914,31814,31815,29915,29916,29917,29918,29919,29920,29921,29922,29923,29924,29925,29926,29927,29929,29930,31816,31818,20002,21417,4721,4289,2070,29885,29891,29815,29817,29819,29820,29872,29873,29874,29875,29876,29878,29881,29898,29899,29900,29901,29902,29903,29904,29905,29906,29907,29908,29909,29910,29911,29912,29726,32148,31801,31895,29151,23776,23531,23573,23576,23498,29714,29716,29715,31835,2524,2453,31779,30325,22444,29177,31780,31338,21457,32986,32987,32988,4312,29799,29800,29804,29805,29784,29785,31141,29671,29674,29712,31773,2710,2712,2713,2715,2716,2717,2718,2719,2720,2723,2725,2726,2727,2728,2730,2731,2732,2733,2734,2735,2736,2738,29735,29737,29738,29739,29742,29743,29745,29746,29747,30358,23238,29828,30303,30306,30309,30310
)

--Расходная накладная t_Inv
SELECT  SUM(d.Qty) SumQty FROM t_Inv m WITH(NOLOCK)
JOIN t_InvD d WITH(NOLOCK) ON d.ChID = m.ChID
WHERE m.DocDate  BETWEEN '20171028' AND '20171228' 
and m.StockID = 4
and ProdID in (26136,32142,30728,26135,23774,23775,31879,31878,22071,24412,3127,32144,33106,33214,32388,28246,26137,28240,28978,33217,28245,32618,32363,32379,26134,33255,30767,29879,29054,32390,32389,30691,32381,3499,33098,33656,26213,33216,31960,28957,30370,30689,31574,32620,33296,31808,2746,2400,32020,30894,33040,33340,32893,29880,28958,30497,33460,33484,4885,27748,26138,32591,32587,33488,4353,33581,33039,32378,2457,2455,23403,4702,33291,33342,32592,33299,33295,33486,33213,29152,33716,32593,32699,32589,32590,26133,32998,32431,33623,21478,33025,32594,32597,32598,32573,2073,31777,27749,32051,29089,28261,4148,33341,31896,33576,30343,32600,32563,32084,27761,31441,33238,32382,32385,33298,32550,27747,31452,28592,30487,24549,28586,33115,32995,33572,31802,29808,32996,32436,33092,33620,33455,33610,33601,3840,25944,28253,31435,33352,33605,33297,33294,32994,33079,33077,33555,32520,32397,32599,32387,31950,33252,26166,31428,32052,32453,32616,31434,31443,33043,32293,33615,33618,33619,33577,25797,32603,31518,32405,32417,32552,32511,32509,4144,33244,33023,33024,32977,32017,4696,32910,33071,32818,32819,32588,32585,32586,33062,33445,4355,33128,29810,33430,33461,33481,33617,33483,33485,32446,32438,33096,33082,33667,32791,32784,32643,32645,31585,31602,31566,27391,25782,30371,28574,31748,30842,31837,32775,29134,32085,31445,31439,32290,33657,33607,33129,31882,31333,32150,32608,32578,31440,29091,31377,30637,25786,32899,33275,33276,33277,33278,32336,31977,22327,32391,32911,32913,32979,32948,33014,4125,32623,32627,33713,31328,24402,33452,33575,33400,33545,32456,32449,32878,33287,33658,33666,33035,33220,4887,4886,33284,22270,33449,2707,32894,28601,31430,30677,32274,32334,32251,32181,33573,33403,33426,33208,32163,31949,32043,4149,29328,31775,32403,32121,32465,33398,32434,32679,32545,31406,31567,31633,28241,28242,28243,28244,27395,27490,30650,31757,31788,31794,31795,31796,31798,30688,30690,26139,30766,24886,24887,24876,24877,24879,26698,26699,31446,31405,31586,31587,31595,31575,31576,31578,31579,31580,31581,31582,31583,31584,31603,31604,31616,31629,31791,24235,31864,31786,31787,31792,31793,31811,31813,31278,31280,26833,26683,31902,31903,31904,31571,31560,31564,31565,31432,31433,31429,26161,26168,31863,25799,31739,31833,31845,31846,31847,31848,31849,31444,31442,31457,31460,31401,31418,31462,31483,31484,31496,31497,31499,31501,31517,31379,31380,31381,31382,31383,31384,31397,31399,31410,31411,31412,31415,31409,31423,31424,31425,31427,30488,30489,30490,32030,32031,26152,31831,31860,31861,31862,30843,30846,30998,31000,31002,30875,30876,31783,31856,28585,28602,28603,28941,28942,28952,28953,31737,29329,29330,31820,26726,26734,27604,27607,27708,27753,27754,28378,28392,28393,28394,28354,28356,25787,25788,25791,25792,25793,25794,25783,25784,25781,28598,28599,29090,29077,29080,29081,29083,30402,30436,30437,30386,30474,30475,30481,30483,30484,29065,29066,30403,30425,30427,30429,30430,31749,30638,30641,30643,30648,32061,32062,32063,32064,32067,32069,32072,32073,32074,32076,32080,32081,32088,32089,32093,32098,32099,32101,32103,32104,32106,32107,31273,31274,30871,30872,31750,30888,30891,30935,30936,30937,31776,31276,30746,30745,30499,30554,30555,30628,31790,31838,31839,24664,26886,27408,27446,27460,27476,30440,30445,30457,30866,30920,30922,30884,30898,31090,31129,31130,31269,31271,31289,31290,31291,31293,31294,31300,31315,31351,31354,31355,31356,31357,31358,31363,31367,31368,31371,31372,31376,32776,32777,32778,32779,26687,24442,27735,27739,27744,28283,31554,31555,31601,30748,31771,27750,31760,31624,31625,31626,31765,31822,31823,31824,31825,31826,31827,31828,31829,32714,32715,32044,32045,32046,32048,30719,30724,31762,32602,31809,30791,30794,31520,31521,31522,28290,32546,1754,32624,32625,32626,32628,32630,32631,32632,32633,32634,32635,32636,32637,32544,4717,32595,4363,32717,32908,32909,33631,33632,33633,33634,33635,33636,33637,33638,33640,33641,33674,32605,32696,32621,32622,32681,32683,32684,32685,32686,32687,32688,32689,32690,32692,32693,32695,32361,32362,4540,4685,32886,32888,32700,32671,32672,32673,32674,32676,32677,32678,4200,32553,32554,32901,32902,32903,32904,32905,32906,33018,33058,33059,33072,33073,33074,33075,31929,31963,31964,32551,32401,32402,32406,32407,32408,32409,32410,32411,32412,32413,32414,33019,32657,32658,32659,31322,31323,31324,32666,32667,32668,32670,32481,32483,32484,32485,32486,32488,32489,32490,32491,32492,32493,32494,32496,32497,32498,32499,32500,32501,32502,32503,32504,32505,32506,32507,32508,4165,4167,32638,32992,32364,32614,32830,32831,32832,32833,32547,33245,33246,33247,33248,33249,4127,4129,4130,4131,4132,4133,4134,4136,4138,4139,4142,32513,32514,32515,32516,32517,32518,32521,32522,32523,32524,32525,32526,32527,32528,32529,32548,32549,33045,33046,33047,33048,33049,33050,33051,33052,33053,22379,32697,32698,32510,32617,32619,4126,33222,33223,33224,33225,33226,33227,33228,33229,32806,32807,32646,32647,32648,32649,32651,32653,32654,33054,33055,33056,33057,33015,33016,33211,4342,32656,33556,33557,33642,33643,33644,33645,33036,32949,32947,33009,33010,33011,33012,33013,32980,32981,32982,32983,32984,33021,33022,32957,32958,32959,32961,32962,32963,32965,32967,32968,32969,32970,32971,32972,32973,32974,32975,32976,32122,32238,32239,32240,32241,32242,32243,32244,32245,32246,32247,32248,32249,32250,32252,32254,32255,31918,31920,31921,32326,32327,32328,32329,32330,32332,32333,32032,32033,32034,32035,32037,32038,32039,32040,2159,32042,32086,32087,32342,33254,33756,31957,31958,31959,31909,31910,31937,32154,32155,32158,32159,32160,32319,32320,32322,32323,32082,32083,33239,32277,32278,32279,32281,32282,32283,32294,32295,32296,32298,32302,32304,32305,32306,32307,32308,32309,32310,32311,32312,32313,32314,32315,32335,32577,32565,32566,32567,32569,32570,32571,32812,32813,32815,32817,32823,32826,32827,32828,31933,32895,31998,32026,32556,32557,32560,32561,32562,32662,32256,32339,32340,32889,32890,32891,32892,32019,4695,1213,1214,33279,33280,32111,32113,32370,32373,32374,32375,32376,32377,33063,33064,33065,33271,33274,32900,32914,33060,33061,32579,32580,32581,32582,32584,31940,31941,31970,31971,32027,32028,33076,32896,32610,32151,32152,32153,21411,32162,31952,31954,31955,32316,32147,31944,31947,31948,3089,32053,32054,32056,32125,32126,32127,32129,32131,32132,32133,32134,32135,32136,32137,32139,32140,32141,32392,32393,32394,32395,32396,32386,32380,32143,32383,32384,32145,32146,32189,32190,32191,32192,32193,32194,32195,32196,32208,32211,32218,32228,32317,32318,32164,32165,32166,32168,32169,32170,32171,32173,21418,21419,32357,32359,32360,32606,32607,32000,32001,32002,32231,32232,32257,32259,2699,32180,32912,32291,31965,31966,31967,32349,32350,32351,32720,32324,32005,32006,32007,32013,32014,32015,32016,32343,32346,33066,33067,33068,33069,31772,31978,31984,31994,31996,31997,31880,32018,32185,32275,32284,32285,32286,32287,32289,32435,32432,32433,32426,32427,32430,33646,33647,33648,33649,33650,33651,33652,33653,33654,33655,33080,33558,33559,33560,33561,33562,32993,33230,33231,4697,33259,33260,33261,33262,33078,32441,32424,32834,32835,32836,32837,32838,32839,32840,32841,32842,32843,32844,32845,32846,32847,32848,33026,1396,33236,33237,32883,32884,32885,33027,33028,33029,33030,33031,33032,33033,33034,33212,33668,33669,4703,4708,4709,32781,32782,32783,33081,32644,32785,32786,32787,32789,32793,32794,32852,32639,32640,32641,32642,4943,4946,4947,4948,32444,1209,1210,1211,33256,33257,1376,4903,33091,33097,33099,1717,33093,33094,33095,33083,33084,33085,33086,33087,33088,33089,33090,32419,32420,32421,32422,32423,4698,32801,32802,32803,32804,32805,32850,32470,32471,32472,32476,32477,32478,32480,32881,32455,32458,33268,33293,32447,32879,32461,32464,32450,32451,32452,21404,21406,32853,32854,32855,32857,32861,32862,32863,32871,32872,32875,32876,33282,33288,33321,33322,33606,33721,33722,33726,33727,33737,33324,33422,33423,33424,33425,33326,2729,33281,33300,33301,33303,33130,33131,33132,33596,33323,33336,33337,33338,33339,33427,33428,33429,33285,33286,33609,33431,33432,33434,33435,33436,33437,33438,33439,33440,33441,33442,33603,33604,33616,33611,33612,33613,33614,33602,33345,33346,33347,33348,33349,33350,33351,33487,33489,33523,33524,33482,33456,33457,33458,33459,33463,33464,33314,33315,33316,33479,33480,33353,33290,22300,33454,33621,33622,33624,33402,33404,33405,33406,33407,33710,33711,33582,33583,33584,33585,33586,33587,33588,33589,33590,33574,33450,33451,33578,33579,33580,33453,33542,33543,33544,33446,33447,33448,33305,33306,33536,33537,33538,33539,33540,33541,33691,33718,33768,33309,33310,33311,33312,33443,33444,33327,33328,33329,33330,33331,33332,33333,33334,33546,33547,33548,33549,33550,33551,33552,33553,33554,33717,33723,33724,33850,2704,2745,29119,29120,29188,31887,31889,31890,31893,29153,31897,31898,32116,32117,32119,32120,2458,2456,32713,2708,29200,32718,32719,29121,29155,21515,31283,2142,21672,31298,31326,31329,31330,22022,22070,33714,33715,33719,27569,31339,29099,29100,29102,29106,29108,29109,29110,29111,29169,29170,29219,29221,29222,23138,23087,33705,33706,33707,33708,33709,22109,33736,2709,29333,2706,29837,29840,29355,22276,22072,22073,27572,33684,33685,33686,33687,33688,33689,33690,33692,33693,33694,4350,31334,30342,29809,4720,2747,23146,4135,4140,33070,27497,27529,23022,31774,4349,29913,29914,31814,31815,29915,29916,29917,29918,29919,29920,29921,29922,29923,29924,29925,29926,29927,29929,29930,31816,31818,20002,21417,4721,4289,2070,29885,29891,29815,29817,29819,29820,29872,29873,29874,29875,29876,29878,29881,29898,29899,29900,29901,29902,29903,29904,29905,29906,29907,29908,29909,29910,29911,29912,29726,32148,31801,31895,29151,23776,23531,23573,23576,23498,29714,29716,29715,31835,2524,2453,31779,30325,22444,29177,31780,31338,21457,32986,32987,32988,4312,29799,29800,29804,29805,29784,29785,31141,29671,29674,29712,31773,2710,2712,2713,2715,2716,2717,2718,2719,2720,2723,2725,2726,2727,2728,2730,2731,2732,2733,2734,2735,2736,2738,29735,29737,29738,29739,29742,29743,29745,29746,29747,30358,23238,29828,30303,30306,30309,30310)



--ВР - Расходный документ t_Exp
SELECT SUM(d.Qty) SumQty FROM t_Exp m WITH(NOLOCK)
JOIN t_ExpD d WITH(NOLOCK) ON d.ChID = m.ChID
WHERE m.DocDate  BETWEEN '20171028' AND '20171228' 
and m.StockID = 4
and ProdID in (26136,32142,30728,26135,23774,23775,31879,31878,22071,24412,3127,32144,33106,33214,32388,28246,26137,28240,28978,33217,28245,32618,32363,32379,26134,33255,30767,29879,29054,32390,32389,30691,32381,3499,33098,33656,26213,33216,31960,28957,30370,30689,31574,32620,33296,31808,2746,2400,32020,30894,33040,33340,32893,29880,28958,30497,33460,33484,4885,27748,26138,32591,32587,33488,4353,33581,33039,32378,2457,2455,23403,4702,33291,33342,32592,33299,33295,33486,33213,29152,33716,32593,32699,32589,32590,26133,32998,32431,33623,21478,33025,32594,32597,32598,32573,2073,31777,27749,32051,29089,28261,4148,33341,31896,33576,30343,32600,32563,32084,27761,31441,33238,32382,32385,33298,32550,27747,31452,28592,30487,24549,28586,33115,32995,33572,31802,29808,32996,32436,33092,33620,33455,33610,33601,3840,25944,28253,31435,33352,33605,33297,33294,32994,33079,33077,33555,32520,32397,32599,32387,31950,33252,26166,31428,32052,32453,32616,31434,31443,33043,32293,33615,33618,33619,33577,25797,32603,31518,32405,32417,32552,32511,32509,4144,33244,33023,33024,32977,32017,4696,32910,33071,32818,32819,32588,32585,32586,33062,33445,4355,33128,29810,33430,33461,33481,33617,33483,33485,32446,32438,33096,33082,33667,32791,32784,32643,32645,31585,31602,31566,27391,25782,30371,28574,31748,30842,31837,32775,29134,32085,31445,31439,32290,33657,33607,33129,31882,31333,32150,32608,32578,31440,29091,31377,30637,25786,32899,33275,33276,33277,33278,32336,31977,22327,32391,32911,32913,32979,32948,33014,4125,32623,32627,33713,31328,24402,33452,33575,33400,33545,32456,32449,32878,33287,33658,33666,33035,33220,4887,4886,33284,22270,33449,2707,32894,28601,31430,30677,32274,32334,32251,32181,33573,33403,33426,33208,32163,31949,32043,4149,29328,31775,32403,32121,32465,33398,32434,32679,32545,31406,31567,31633,28241,28242,28243,28244,27395,27490,30650,31757,31788,31794,31795,31796,31798,30688,30690,26139,30766,24886,24887,24876,24877,24879,26698,26699,31446,31405,31586,31587,31595,31575,31576,31578,31579,31580,31581,31582,31583,31584,31603,31604,31616,31629,31791,24235,31864,31786,31787,31792,31793,31811,31813,31278,31280,26833,26683,31902,31903,31904,31571,31560,31564,31565,31432,31433,31429,26161,26168,31863,25799,31739,31833,31845,31846,31847,31848,31849,31444,31442,31457,31460,31401,31418,31462,31483,31484,31496,31497,31499,31501,31517,31379,31380,31381,31382,31383,31384,31397,31399,31410,31411,31412,31415,31409,31423,31424,31425,31427,30488,30489,30490,32030,32031,26152,31831,31860,31861,31862,30843,30846,30998,31000,31002,30875,30876,31783,31856,28585,28602,28603,28941,28942,28952,28953,31737,29329,29330,31820,26726,26734,27604,27607,27708,27753,27754,28378,28392,28393,28394,28354,28356,25787,25788,25791,25792,25793,25794,25783,25784,25781,28598,28599,29090,29077,29080,29081,29083,30402,30436,30437,30386,30474,30475,30481,30483,30484,29065,29066,30403,30425,30427,30429,30430,31749,30638,30641,30643,30648,32061,32062,32063,32064,32067,32069,32072,32073,32074,32076,32080,32081,32088,32089,32093,32098,32099,32101,32103,32104,32106,32107,31273,31274,30871,30872,31750,30888,30891,30935,30936,30937,31776,31276,30746,30745,30499,30554,30555,30628,31790,31838,31839,24664,26886,27408,27446,27460,27476,30440,30445,30457,30866,30920,30922,30884,30898,31090,31129,31130,31269,31271,31289,31290,31291,31293,31294,31300,31315,31351,31354,31355,31356,31357,31358,31363,31367,31368,31371,31372,31376,32776,32777,32778,32779,26687,24442,27735,27739,27744,28283,31554,31555,31601,30748,31771,27750,31760,31624,31625,31626,31765,31822,31823,31824,31825,31826,31827,31828,31829,32714,32715,32044,32045,32046,32048,30719,30724,31762,32602,31809,30791,30794,31520,31521,31522,28290,32546,1754,32624,32625,32626,32628,32630,32631,32632,32633,32634,32635,32636,32637,32544,4717,32595,4363,32717,32908,32909,33631,33632,33633,33634,33635,33636,33637,33638,33640,33641,33674,32605,32696,32621,32622,32681,32683,32684,32685,32686,32687,32688,32689,32690,32692,32693,32695,32361,32362,4540,4685,32886,32888,32700,32671,32672,32673,32674,32676,32677,32678,4200,32553,32554,32901,32902,32903,32904,32905,32906,33018,33058,33059,33072,33073,33074,33075,31929,31963,31964,32551,32401,32402,32406,32407,32408,32409,32410,32411,32412,32413,32414,33019,32657,32658,32659,31322,31323,31324,32666,32667,32668,32670,32481,32483,32484,32485,32486,32488,32489,32490,32491,32492,32493,32494,32496,32497,32498,32499,32500,32501,32502,32503,32504,32505,32506,32507,32508,4165,4167,32638,32992,32364,32614,32830,32831,32832,32833,32547,33245,33246,33247,33248,33249,4127,4129,4130,4131,4132,4133,4134,4136,4138,4139,4142,32513,32514,32515,32516,32517,32518,32521,32522,32523,32524,32525,32526,32527,32528,32529,32548,32549,33045,33046,33047,33048,33049,33050,33051,33052,33053,22379,32697,32698,32510,32617,32619,4126,33222,33223,33224,33225,33226,33227,33228,33229,32806,32807,32646,32647,32648,32649,32651,32653,32654,33054,33055,33056,33057,33015,33016,33211,4342,32656,33556,33557,33642,33643,33644,33645,33036,32949,32947,33009,33010,33011,33012,33013,32980,32981,32982,32983,32984,33021,33022,32957,32958,32959,32961,32962,32963,32965,32967,32968,32969,32970,32971,32972,32973,32974,32975,32976,32122,32238,32239,32240,32241,32242,32243,32244,32245,32246,32247,32248,32249,32250,32252,32254,32255,31918,31920,31921,32326,32327,32328,32329,32330,32332,32333,32032,32033,32034,32035,32037,32038,32039,32040,2159,32042,32086,32087,32342,33254,33756,31957,31958,31959,31909,31910,31937,32154,32155,32158,32159,32160,32319,32320,32322,32323,32082,32083,33239,32277,32278,32279,32281,32282,32283,32294,32295,32296,32298,32302,32304,32305,32306,32307,32308,32309,32310,32311,32312,32313,32314,32315,32335,32577,32565,32566,32567,32569,32570,32571,32812,32813,32815,32817,32823,32826,32827,32828,31933,32895,31998,32026,32556,32557,32560,32561,32562,32662,32256,32339,32340,32889,32890,32891,32892,32019,4695,1213,1214,33279,33280,32111,32113,32370,32373,32374,32375,32376,32377,33063,33064,33065,33271,33274,32900,32914,33060,33061,32579,32580,32581,32582,32584,31940,31941,31970,31971,32027,32028,33076,32896,32610,32151,32152,32153,21411,32162,31952,31954,31955,32316,32147,31944,31947,31948,3089,32053,32054,32056,32125,32126,32127,32129,32131,32132,32133,32134,32135,32136,32137,32139,32140,32141,32392,32393,32394,32395,32396,32386,32380,32143,32383,32384,32145,32146,32189,32190,32191,32192,32193,32194,32195,32196,32208,32211,32218,32228,32317,32318,32164,32165,32166,32168,32169,32170,32171,32173,21418,21419,32357,32359,32360,32606,32607,32000,32001,32002,32231,32232,32257,32259,2699,32180,32912,32291,31965,31966,31967,32349,32350,32351,32720,32324,32005,32006,32007,32013,32014,32015,32016,32343,32346,33066,33067,33068,33069,31772,31978,31984,31994,31996,31997,31880,32018,32185,32275,32284,32285,32286,32287,32289,32435,32432,32433,32426,32427,32430,33646,33647,33648,33649,33650,33651,33652,33653,33654,33655,33080,33558,33559,33560,33561,33562,32993,33230,33231,4697,33259,33260,33261,33262,33078,32441,32424,32834,32835,32836,32837,32838,32839,32840,32841,32842,32843,32844,32845,32846,32847,32848,33026,1396,33236,33237,32883,32884,32885,33027,33028,33029,33030,33031,33032,33033,33034,33212,33668,33669,4703,4708,4709,32781,32782,32783,33081,32644,32785,32786,32787,32789,32793,32794,32852,32639,32640,32641,32642,4943,4946,4947,4948,32444,1209,1210,1211,33256,33257,1376,4903,33091,33097,33099,1717,33093,33094,33095,33083,33084,33085,33086,33087,33088,33089,33090,32419,32420,32421,32422,32423,4698,32801,32802,32803,32804,32805,32850,32470,32471,32472,32476,32477,32478,32480,32881,32455,32458,33268,33293,32447,32879,32461,32464,32450,32451,32452,21404,21406,32853,32854,32855,32857,32861,32862,32863,32871,32872,32875,32876,33282,33288,33321,33322,33606,33721,33722,33726,33727,33737,33324,33422,33423,33424,33425,33326,2729,33281,33300,33301,33303,33130,33131,33132,33596,33323,33336,33337,33338,33339,33427,33428,33429,33285,33286,33609,33431,33432,33434,33435,33436,33437,33438,33439,33440,33441,33442,33603,33604,33616,33611,33612,33613,33614,33602,33345,33346,33347,33348,33349,33350,33351,33487,33489,33523,33524,33482,33456,33457,33458,33459,33463,33464,33314,33315,33316,33479,33480,33353,33290,22300,33454,33621,33622,33624,33402,33404,33405,33406,33407,33710,33711,33582,33583,33584,33585,33586,33587,33588,33589,33590,33574,33450,33451,33578,33579,33580,33453,33542,33543,33544,33446,33447,33448,33305,33306,33536,33537,33538,33539,33540,33541,33691,33718,33768,33309,33310,33311,33312,33443,33444,33327,33328,33329,33330,33331,33332,33333,33334,33546,33547,33548,33549,33550,33551,33552,33553,33554,33717,33723,33724,33850,2704,2745,29119,29120,29188,31887,31889,31890,31893,29153,31897,31898,32116,32117,32119,32120,2458,2456,32713,2708,29200,32718,32719,29121,29155,21515,31283,2142,21672,31298,31326,31329,31330,22022,22070,33714,33715,33719,27569,31339,29099,29100,29102,29106,29108,29109,29110,29111,29169,29170,29219,29221,29222,23138,23087,33705,33706,33707,33708,33709,22109,33736,2709,29333,2706,29837,29840,29355,22276,22072,22073,27572,33684,33685,33686,33687,33688,33689,33690,33692,33693,33694,4350,31334,30342,29809,4720,2747,23146,4135,4140,33070,27497,27529,23022,31774,4349,29913,29914,31814,31815,29915,29916,29917,29918,29919,29920,29921,29922,29923,29924,29925,29926,29927,29929,29930,31816,31818,20002,21417,4721,4289,2070,29885,29891,29815,29817,29819,29820,29872,29873,29874,29875,29876,29878,29881,29898,29899,29900,29901,29902,29903,29904,29905,29906,29907,29908,29909,29910,29911,29912,29726,32148,31801,31895,29151,23776,23531,23573,23576,23498,29714,29716,29715,31835,2524,2453,31779,30325,22444,29177,31780,31338,21457,32986,32987,32988,4312,29799,29800,29804,29805,29784,29785,31141,29671,29674,29712,31773,2710,2712,2713,2715,2716,2717,2718,2719,2720,2723,2725,2726,2727,2728,2730,2731,2732,2733,2734,2735,2736,2738,29735,29737,29738,29739,29742,29743,29745,29746,29747,30358,23238,29828,30303,30306,30309,30310)

and ProdID in (32363)


SELECT * FROM t_Exp m WITH(NOLOCK)
JOIN t_ExpD d WITH(NOLOCK) ON d.ChID = m.ChID
WHERE m.DocDate  BETWEEN '20171028' AND '20171228' 
and m.StockID = 4
and ProdID in (32363)


31441
32363
33238

--SELECT * FROM r_Uni where 6660154=RefTypeID


--SELECT * FROM [AzTempDB].[CONST\pashkovv].[v_014_00439_1_CONST\pashkovv]

DECLARE @StockID table(StockID int NULL) 
insert into @StockID select StockID from r_Stocks where StockID in (
--Введите Номера складов
	
4,304
)

SELECT * FROM @StockID




/*
SELECT PCatIDi, (SELECT top 1 PCatName FROM r_ProdC pc WHERE pc.PCatID = PCatIDi) PCatName 
,[1],[2],[3],[4],[5],[6],[7],[8],[9],[10],[11],[12],[13],[14],[15],[16],[17],[18],[19],[20],[21],[22],[23],[24],[25],[26],[27],[28],[29],[30],[31],[32],[33],[34],[35],[36],[37],[38],[39],[40],[41],[42],[43],[44],[45],[46],[47],[48],[49],[50],[51],[52],[53]  
FROM at_t_PCatIDImport 
PIVOT ( 
MAX(Percents)FOR WeekID IN([1],[2],[3],[4],[5],[6],[7],[8],[9],[10],[11],[12],[13],[14],[15],[16],[17],[18],[19],[20],[21],[22],[23],[24],[25],[26],[27],[28],[29],[30],[31],[32],[33],[34],[35],[36],[37],[38],[39],[40],[41],[42],[43],[44],[45],[46],[47],[48],[49],[50],[51],[52],[53]) 
)pvt
ORDER BY 2
*/

--SELECT top 1000 Qty,* FROM r_ProdMQ where UM = 'ящ.'



/*
--заливка новой таблицы процентов из экселя
IF OBJECT_ID (N'tempdb..#PercentCat', N'U') IS NOT NULL DROP TABLE #PercentCat

SELECT pc.PCatID, ors.* 
 INTO #PercentCat
FROM OPENROWSET('Microsoft.ACE.OLEDB.12.0', N'Excel 12.0; IMEX=1; Database=\\s-sql-d4\OT38ElitServer\Import\PercentCat.xlsx' , 'select * from [Лист1$]') ors
LEFT JOIN (SELECT PCatID, PCatName FROM r_ProdC) pc on ors.PCatName = pc.PCatName

SELECT * FROM #PercentCat
 
--SELECT SUM(PCatIDi) FROM at_t_PCatIDImport--14257
--SELECT SUM(WeekID) FROM at_t_PCatIDImport--28620
--SELECT SUM(Percents) FROM at_t_PCatIDImport--1522.600704155 (было 1101.634083842)


delete at_t_PCatIDImport

INSERT at_t_PCatIDImport
--SELECT SUM(cast(Percents as numeric(21,9))) FROM(		
SELECT PCatID, WeekID, Percents
FROM 
   (SELECT * FROM #PercentCat) p
UNPIVOT
   (Percents FOR WeekID IN ([1],[2],[3],[4],[5],[6],[7],[8],[9],[10],[11],[12],[13],[14],[15],[16],[17],[18],[19],[20],[21],[22],[23],[24],[25],[26],[27],[28],[29],[30],[31],[32],[33],[34],[35],[36],[37],[38],[39],[40],[41],[42],[43],[44],[45],[46],[47],[48],[49],[50],[51],[52],[53])
)AS unpvt
--) s1

*/